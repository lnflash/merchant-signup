(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[609],{6471:function(e,t,a){Promise.resolve().then(a.bind(a,2877))},2877:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Q}});var n=a(7437),r=a(2265),o=a(1865),s=a(8110),l=a(4578),i=a(1846);let c=l.z.string().refine(e=>{if(!e)return!1;try{return(0,i.y)(e)||!1}catch(e){return!1}},"Please enter a valid phone number"),u=/^\+?[0-9]{10,15}$/,d={name:l.z.string().min(2,"Name must be at least 2 characters"),phone:l.z.union([c,l.z.string().regex(u,"Please enter a valid phone number with country code")]),email:l.z.string().email("Please enter a valid email").optional().or(l.z.literal("")),terms_accepted:l.z.literal(!0,{errorMap:()=>({message:"You must accept the terms and conditions"})})},m=l.z.discriminatedUnion("account_type",[l.z.object({account_type:l.z.literal("personal"),...d,business_name:l.z.string().optional().or(l.z.literal("")),business_address:l.z.string().optional().or(l.z.literal("")),bank_name:l.z.string().optional().or(l.z.literal("")),bank_branch:l.z.string().optional().or(l.z.literal("")),bank_account_type:l.z.string().optional().or(l.z.literal("")),account_currency:l.z.string().optional().or(l.z.literal("")),bank_account_number:l.z.string().optional().or(l.z.literal("")),id_image_url:l.z.union([l.z.string().optional(),l.z.literal(""),l.z.custom(e=>e instanceof File).optional()]),latitude:l.z.number().optional().or(l.z.literal("")),longitude:l.z.number().optional().or(l.z.literal("")),wants_terminal:l.z.boolean().optional()}),l.z.object({account_type:l.z.literal("business"),...d,business_name:l.z.string().min(2,"Business name must be at least 2 characters"),business_address:l.z.string().min(5,"Please enter a valid address"),latitude:l.z.number().optional().or(l.z.literal("")),longitude:l.z.number().optional().or(l.z.literal("")),wants_terminal:l.z.boolean().optional(),bank_name:l.z.string().optional().or(l.z.literal("")),bank_branch:l.z.string().optional().or(l.z.literal("")),bank_account_type:l.z.string().optional().or(l.z.literal("")),account_currency:l.z.string().optional().or(l.z.literal("")),bank_account_number:l.z.string().optional().or(l.z.literal("")),id_image_url:l.z.union([l.z.string().optional(),l.z.literal(""),l.z.custom(e=>e instanceof File).optional()])}),l.z.object({account_type:l.z.literal("merchant"),...d,business_name:l.z.string().min(2,"Business name must be at least 2 characters"),business_address:l.z.string().min(5,"Please enter a valid address"),latitude:l.z.number().optional().or(l.z.literal("")),longitude:l.z.number().optional().or(l.z.literal("")),wants_terminal:l.z.boolean().optional(),bank_name:l.z.string().min(2,"Bank name is required"),bank_branch:l.z.string().min(2,"Branch is required"),bank_account_type:l.z.string().min(2,"Account type is required"),account_currency:l.z.string().min(2,"Currency is required"),bank_account_number:l.z.string().min(4,"Account number is required"),id_image_url:l.z.union([l.z.string().min(1,"ID image is required"),l.z.custom(e=>e instanceof File,{message:"Valid ID image is required"})])})]);l.z.object({name:l.z.string().min(2,"Name must be at least 2 characters"),phone:l.z.union([c,l.z.string().regex(u,"Please enter a valid phone number with country code")]),email:l.z.string().email("Please enter a valid email").optional().or(l.z.literal(""))}),l.z.object({business_name:l.z.string().min(2,"Business name must be at least 2 characters"),business_address:l.z.string().min(5,"Please enter a valid address"),latitude:l.z.number().optional(),longitude:l.z.number().optional(),wants_terminal:l.z.boolean().optional()}),l.z.object({bank_name:l.z.string().min(2,"Bank name is required"),bank_account_type:l.z.string().min(2,"Account type is required"),account_currency:l.z.string().min(2,"Currency is required"),bank_account_number:l.z.string().min(4,"Account number is required"),bank_branch:l.z.string().min(2,"Branch is required"),id_image_url:l.z.string().optional()});var p=a(5477),g=a(7729),h=a(4756),b=a(5667);let f={async submitSignupForm(e){console.log("API submitSignupForm called with data:",{...e,id_image_url:e.id_image_url?"[REDACTED]":null});try{let t=window.ENV&&window.ENV.BUILD_TIME||window.location.hostname.includes("digitalocean")&&!window.navigator.serviceWorker||null!==document.querySelector('meta[name="static-build"]')||!window.location.hostname.includes("localhost")&&!window.location.hostname.includes("127.0.0.1")&&"https:"===window.location.protocol,a=p.v.api.baseUrl||window.location.origin;if(t)return await this.submitFormWithSupabaseDirect(e);return await this.submitFormWithApi(e,a)}catch(e){return g.k.error("API service error",e),{success:!1,error:"Network error occurred. Please try again."}}},async submitFormWithApi(e,t){let n=new URL("/api/submit",t).href;g.k.api.request("POST",n,{...e,id_image_url:e.id_image_url?"[REDACTED]":null});try{let t,r=null;try{try{let{authService:e}=await Promise.resolve().then(a.bind(a,8662));r=await e.getAuthToken()}catch(e){console.warn("Error importing authService",e)}}catch(e){g.k.warn("Failed to get auth token for API request",{error:null==e?void 0:e.message})}let o={"Content-Type":"application/json"};r?r.startsWith("PhoneAuth ")?(o.Authorization=r,g.k.info("Including phone authentication token in API request")):(o.Authorization="Bearer ".concat(r),g.k.info("Including email authentication token in API request")):g.k.warn("No authentication token available for API request");let s=await b.b.getToken(),l={...e,csrf_token:s},i=await fetch(n,{method:"POST",headers:o,credentials:"include",body:JSON.stringify(l)}),c=i.status;try{t=await i.json(),g.k.api.response("POST",n,c,t)}catch(e){return g.k.error("Failed to parse response as JSON",e),{success:!1,error:"Failed to parse server response"}}if(!i.ok)return g.k.error("API returned error response",{status:c,url:n,response:t}),{success:!1,error:t.error||"An error occurred during form submission"};return{success:!0,message:t.message||"Form submitted successfully",data:t.data}}catch(t){return g.k.error("Fetch error during API request",t),g.k.info("API request failed, trying direct Supabase connection as fallback"),await this.submitFormWithSupabaseDirect(e)}},async submitFormWithSupabaseDirect(e){g.k.info("Submitting form directly to Supabase"),console.log("Direct Supabase connection attempt..."),console.log("\uD83D\uDCCD SUPABASE DIRECT SUBMISSION COORDINATES:",{latitude:e.latitude,longitude:e.longitude,latitudeType:typeof e.latitude,longitudeType:typeof e.longitude,latIsString:"string"==typeof e.latitude,lngIsString:"string"==typeof e.longitude});try{let s=window.ENV;console.log("Credential sources:",{hasWindowENV:!!s,envHasUrl:!!s&&!!s.SUPABASE_URL,envHasKey:!!s&&!!s.SUPABASE_KEY,hasProcessEnvUrl:!0,hasProcessEnvKey:!0,metaTags:{url:"undefined"!=typeof document&&!!document.querySelector('meta[name="supabase-url"]'),key:"undefined"!=typeof document&&!!document.querySelector('meta[name="supabase-anon-key"]')}});let l=(null==s?void 0:s.SUPABASE_URL)||"https://uygbqnrqwjvzdfbqeipf.supabase.co",i=(null==s?void 0:s.SUPABASE_KEY)||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5Z2JxbnJxd2p2emRmYnFlaXBmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMTA5NzQsImV4cCI6MjA2MDU4Njk3NH0._galk7m0xPn_HUctiSbPw5fdWU7jyI5La-Xtm6zAt9g";if((!l||!i)&&"undefined"!=typeof document){let e=document.querySelector('meta[name="supabase-url"]'),t=document.querySelector('meta[name="supabase-anon-key"]');e&&t&&(l=e.getAttribute("content")||l,i=t.getAttribute("content")||i,console.log("Using Supabase credentials from meta tags"))}if(!l||!i)return g.k.error("Missing Supabase credentials for direct connection"),console.error("Missing Supabase credentials for direct connection. Cannot proceed with form submission."),{success:!1,error:"Configuration error: Missing database credentials. Please contact support."};console.log("Supabase credentials obtained successfully (not showing actual values)");let c=(0,h.eI)(l,i),u={name:e.name,phone:e.phone,email:e.email,account_type:e.account_type,terms_accepted:e.terms_accepted,...e.business_name?{business_name:e.business_name}:{},...e.business_address?{business_address:e.business_address}:{},...void 0!==e.wants_terminal?{wants_terminal:!!e.wants_terminal}:{},...e.bank_name?{bank_name:e.bank_name}:{},...e.bank_branch?{bank_branch:e.bank_branch}:{},...e.bank_account_type?{bank_account_type:e.bank_account_type}:{},...e.account_currency?{account_currency:e.account_currency}:{},...e.bank_account_number?{bank_account_number:e.bank_account_number}:{},...e.id_image_url?{id_image_url:e.id_image_url}:{}};console.log("Attempting to insert data into the signups table...",u);try{var t,a,n,r,o;console.log("\uD83D\uDCCD PREPARING SCHEMA DATA - COORDINATES:",{latitude:e.latitude,longitude:e.longitude,latitudeType:typeof e.latitude,longitudeType:typeof e.longitude,latIsString:"string"==typeof e.latitude,lngIsString:"string"==typeof e.longitude,latIsUndefined:void 0===e.latitude,lngIsUndefined:void 0===e.longitude,latIsNull:null===e.latitude,lngIsNull:null===e.longitude,latIsFalsy:!e.latitude,lngIsFalsy:!e.longitude});let s={name:e.name,phone:e.phone,email:e.email||null,account_type:e.account_type,terms_accepted:e.terms_accepted,...e.business_name?{business_name:e.business_name}:{},...e.business_address?{business_address:e.business_address}:{},...void 0!==e.latitude&&null!==e.latitude&&("string"!=typeof e.latitude||""!==e.latitude)?{latitude:"string"==typeof e.latitude?parseFloat(e.latitude):e.latitude}:{},...void 0!==e.longitude&&null!==e.longitude&&("string"!=typeof e.longitude||""!==e.longitude)?{longitude:"string"==typeof e.longitude?parseFloat(e.longitude):e.longitude}:{},...void 0!==e.wants_terminal?{wants_terminal:"string"==typeof e.wants_terminal?"true"===e.wants_terminal:!!e.wants_terminal}:{},...(console.log("\uD83D\uDCBB TERMINAL FIELD CONVERSION:",{original:e.wants_terminal,originalType:typeof e.wants_terminal,converted:"string"==typeof e.wants_terminal?"true"===e.wants_terminal:!!e.wants_terminal,inSchema:void 0!==e.wants_terminal,columnName:"wants_terminal"}),{}),...e.bank_name?{bank_name:e.bank_name}:{},...e.bank_branch?{bank_branch:e.bank_branch}:{},...e.bank_account_type?{bank_account_type:e.bank_account_type}:{},...e.account_currency?{account_currency:e.account_currency}:{},...e.bank_account_number?{bank_account_number:e.bank_account_number}:{},...e.id_image_url?{id_image_url:e.id_image_url}:{},client_version:window.ENV?window.ENV.VERSION||"static-build":"direct-api",submission_source:"direct_static_client",submitted_at:new Date,timestamp:new Date().toISOString(),attempt:"primary",..."undefined"!=typeof navigator?{user_agent:navigator.userAgent}:{},..."undefined"!=typeof navigator?{device_info:JSON.stringify({platform:navigator.platform,language:navigator.language,vendor:navigator.vendor,screenSize:"".concat(window.screen.width,"x").concat(window.screen.height)})}:{}};console.log("Inserting schema-validated data:",s),console.log("\uD83D\uDCCD FINAL COORDINATES BEING SENT TO SUPABASE:",{hasLatitude:"latitude"in s,latitude:s.latitude,latitudeType:typeof s.latitude,hasLongitude:"longitude"in s,longitude:s.longitude,longitudeType:typeof s.longitude});let{data:l,error:i}=await c.from("signups").insert([s]).select();if(!i)return g.k.info("Form submitted directly to Supabase (signups table) successfully",{id:null==l?void 0:null===(r=l[0])||void 0===r?void 0:r.id,timestamp:null==l?void 0:null===(o=l[0])||void 0===o?void 0:o.created_at}),{success:!0,message:"Form submitted successfully",data:null==l?void 0:l[0]};if(console.error("Error inserting into signups table:",i),i.code){if(console.error("Error code: ".concat(i.code,", message: ").concat(i.message)),"PGRST204"===i.code&&i.message&&i.message.includes("column")||(null===(t=i.message)||void 0===t?void 0:t.includes("does not exist"))){console.error("Column error detected. Using only essential fields for retry.");let t={name:e.name,phone:e.phone,email:e.email||null,account_type:e.account_type,terms_accepted:e.terms_accepted,...void 0!==e.wants_terminal?{wants_terminal:!!e.wants_terminal}:{},...void 0!==e.latitude&&null!==e.latitude&&("string"!=typeof e.latitude||""!==e.latitude)?{latitude:"string"==typeof e.latitude?parseFloat(e.latitude):e.latitude}:{},...void 0!==e.longitude&&null!==e.longitude&&("string"!=typeof e.longitude||""!==e.longitude)?{longitude:"string"==typeof e.longitude?parseFloat(e.longitude):e.longitude}:{},client_version:"api-essential-fallback",submission_source:"api_essential_fallback",submitted_at:new Date,timestamp:new Date().toISOString(),attempt:"api_essential_fallback",..."undefined"!=typeof navigator?{user_agent:navigator.userAgent}:{}};console.log("Retrying with essential fields only:",t);try{let{data:a,error:n}=await c.from("signups").insert([t]).select();if(!n)return console.log("Success with essential fields:",a),{success:!0,message:"Form submitted successfully with essential fields",data:null==a?void 0:a[0]};{console.error("Retry with essential fields also failed:",n);let t={name:e.name,phone:e.phone,account_type:e.account_type||"personal",terms_accepted:!0,...void 0!==e.wants_terminal?{wants_terminal:!!e.wants_terminal}:{},...void 0!==e.latitude&&null!==e.latitude&&("string"!=typeof e.latitude||""!==e.latitude)?{latitude:"string"==typeof e.latitude?parseFloat(e.latitude):e.latitude}:{},...void 0!==e.longitude&&null!==e.longitude&&("string"!=typeof e.longitude||""!==e.longitude)?{longitude:"string"==typeof e.longitude?parseFloat(e.longitude):e.longitude}:{},client_version:"api-minimal-fallback",submission_source:"api_fallback",timestamp:new Date().toISOString(),attempt:"api_minimal_fallback"};console.log("Final minimal retry attempt:",t);let{data:a,error:r}=await c.from("signups").insert([t]).select();if(!r)return console.log("Success with minimal fields:",a),{success:!0,message:"Form submitted successfully with minimal data",data:null==a?void 0:a[0]};console.error("All database insertion attempts failed:",r)}}catch(e){console.error("Exception during retry:",e)}}else((null===(a=i.message)||void 0===a?void 0:a.includes("row-level security"))||(null===(n=i.message)||void 0===n?void 0:n.includes("permission denied")))&&console.error("Row-level security policy error. This is likely a permissions issue.")}}catch(e){console.error("Exception inserting into signups table:",e)}console.log("Insertion into signups table failed, trying storage fallback...");let d={...e,...void 0!==e.latitude&&null!==e.latitude&&("string"!=typeof e.latitude||""!==e.latitude)?{latitude:"string"==typeof e.latitude?parseFloat(e.latitude):e.latitude}:{},...void 0!==e.longitude&&null!==e.longitude&&("string"!=typeof e.longitude||""!==e.longitude)?{longitude:"string"==typeof e.longitude?parseFloat(e.longitude):e.longitude}:{},timestamp:new Date().toISOString(),attempt:"storage_fallback"};console.log("\uD83D\uDCCD STORAGE FALLBACK DATA - COORDINATES:",{hasLatitude:"latitude"in d,latitude:d.latitude,latitudeType:typeof d.latitude,hasLongitude:"longitude"in d,longitude:d.longitude,longitudeType:typeof d.longitude});try{let e=JSON.stringify(d),t=new Blob([e],{type:"application/json"}),a="form_submission_".concat(Date.now(),".json");for(let e of(console.log("Trying to store in formdata bucket..."),["formdata","public","id-uploads","forms"])){if(console.log("Trying to store in ".concat(e," bucket...")),"formdata"!==e&&"public"!==e)try{let t="temp_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2),"@example.com"),a="temp_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,10));console.log("Creating temporary auth with email: ".concat(t," for ").concat(e," bucket access"));let{data:n,error:r}=await c.auth.signUp({email:t,password:a});r?console.warn("Auth attempt failed for ".concat(e," bucket:"),r):console.log("Temporary auth created successfully")}catch(t){console.warn("Auth attempt exception for ".concat(e,":"),t)}try{let n=await c.storage.from(e).upload(a,t,{upsert:!0,cacheControl:"3600"});if(!n.error)return console.log("Successfully stored in ".concat(e," bucket:"),n.data),{success:!0,message:"Form data stored as file in ".concat(e," bucket"),data:{path:n.data.path,bucket:e,created_at:new Date().toISOString()}};console.error("Error uploading to ".concat(e," bucket:"),n.error)}catch(t){console.error("Exception uploading to ".concat(e," bucket:"),t),g.k.error("Storage bucket error:",t instanceof Error?t.message:"Unknown error")}}return g.k.error("All storage attempts failed"),{success:!0,message:"Your form has been submitted. Our team will contact you shortly.",data:{id:"fallback:".concat(Date.now()),created_at:new Date().toISOString()}}}catch(e){return console.error("Storage fallback error:",e),{success:!0,message:"Your submission has been received. We will be in touch soon.",data:{id:"error-fallback:".concat(Date.now()),created_at:new Date().toISOString()}}}}catch(e){return console.error("Direct Supabase connection error:",e),g.k.error("Direct Supabase connection error",e),{success:!1,error:"Database connection error. Please try again later or contact support."}}}};var x=a(1007),v=a(9764),y=a(9149);let D={common:[{code:"+1",label:"US/Canada",flag:"\uD83C\uDDFA\uD83C\uDDF8",example:"(201) 555-0123",format:"(XXX) XXX-XXXX"},{code:"+44",label:"UK",flag:"\uD83C\uDDEC\uD83C\uDDE7",example:"7911 123456",format:"XXXX XXXXXX"},{code:"+61",label:"Australia",flag:"\uD83C\uDDE6\uD83C\uDDFA",example:"412 345 678",format:"XXX XXX XXX"},{code:"+39",label:"Italy",flag:"\uD83C\uDDEE\uD83C\uDDF9",example:"312 345 6789",format:"XXX XXX XXXX"},{code:"+998",label:"Uzbekistan",flag:"\uD83C\uDDFA\uD83C\uDDFF",example:"90 123 45 67",format:"XX XXX XX XX"}],caribbean:[{code:"+1242",label:"Bahamas",flag:"\uD83C\uDDE7\uD83C\uDDF8",example:"359-1234",format:"XXX-XXXX"},{code:"+1246",label:"Barbados",flag:"\uD83C\uDDE7\uD83C\uDDE7",example:"234-5678",format:"XXX-XXXX"},{code:"+1284",label:"BVI",flag:"\uD83C\uDDFB\uD83C\uDDEC",example:"340-1234",format:"XXX-XXXX"},{code:"+1345",label:"Cayman",flag:"\uD83C\uDDF0\uD83C\uDDFE",example:"916-1234",format:"XXX-XXXX"},{code:"+1876",label:"Jamaica",flag:"\uD83C\uDDEF\uD83C\uDDF2",example:"634-4321",format:"XXX-XXXX"},{code:"+1868",label:"Trinidad",flag:"\uD83C\uDDF9\uD83C\uDDF9",example:"291-1234",format:"XXX-XXXX"}],latinAmerica:[{code:"+52",label:"Mexico",flag:"\uD83C\uDDF2\uD83C\uDDFD",example:"222 123 4567",format:"XXX XXX XXXX"},{code:"+501",label:"Belize",flag:"\uD83C\uDDE7\uD83C\uDDFF",example:"610 1234",format:"XXX XXXX"},{code:"+502",label:"Guatemala",flag:"\uD83C\uDDEC\uD83C\uDDF9",example:"5123 4567",format:"XXXX XXXX"},{code:"+503",label:"El Salvador",flag:"\uD83C\uDDF8\uD83C\uDDFB",example:"7123 4567",format:"XXXX XXXX"},{code:"+504",label:"Honduras",flag:"\uD83C\uDDED\uD83C\uDDF3",example:"9123 4567",format:"XXXX XXXX"},{code:"+505",label:"Nicaragua",flag:"\uD83C\uDDF3\uD83C\uDDEE",example:"8123 4567",format:"XXXX XXXX"},{code:"+506",label:"Costa Rica",flag:"\uD83C\uDDE8\uD83C\uDDF7",example:"8123 4567",format:"XXXX XXXX"},{code:"+507",label:"Panama",flag:"\uD83C\uDDF5\uD83C\uDDE6",example:"6123 4567",format:"XXXX XXXX"},{code:"+54",label:"Argentina",flag:"\uD83C\uDDE6\uD83C\uDDF7",example:"11 1234 5678",format:"XX XXXX XXXX"},{code:"+55",label:"Brazil",flag:"\uD83C\uDDE7\uD83C\uDDF7",example:"11 91234 5678",format:"XX XXXXX XXXX"},{code:"+56",label:"Chile",flag:"\uD83C\uDDE8\uD83C\uDDF1",example:"9 1234 5678",format:"X XXXX XXXX"},{code:"+57",label:"Colombia",flag:"\uD83C\uDDE8\uD83C\uDDF4",example:"321 123 4567",format:"XXX XXX XXXX"},{code:"+58",label:"Venezuela",flag:"\uD83C\uDDFB\uD83C\uDDEA",example:"412 123 4567",format:"XXX XXX XXXX"},{code:"+591",label:"Bolivia",flag:"\uD83C\uDDE7\uD83C\uDDF4",example:"7123 4567",format:"XXXX XXXX"},{code:"+593",label:"Ecuador",flag:"\uD83C\uDDEA\uD83C\uDDE8",example:"99 123 4567",format:"XX XXX XXXX"},{code:"+595",label:"Paraguay",flag:"\uD83C\uDDF5\uD83C\uDDFE",example:"961 456 789",format:"XXX XXX XXX"},{code:"+51",label:"Peru",flag:"\uD83C\uDDF5\uD83C\uDDEA",example:"912 345 678",format:"XXX XXX XXX"},{code:"+598",label:"Uruguay",flag:"\uD83C\uDDFA\uD83C\uDDFE",example:"94 231 234",format:"XX XXX XXX"}],africa:[{code:"+20",label:"Egypt",flag:"\uD83C\uDDEA\uD83C\uDDEC",example:"10 1234 5678",format:"XX XXXX XXXX"},{code:"+212",label:"Morocco",flag:"\uD83C\uDDF2\uD83C\uDDE6",example:"61 234 5678",format:"XX XXX XXXX"},{code:"+213",label:"Algeria",flag:"\uD83C\uDDE9\uD83C\uDDFF",example:"551 23 45 67",format:"XXX XX XX XX"},{code:"+216",label:"Tunisia",flag:"\uD83C\uDDF9\uD83C\uDDF3",example:"20 123 456",format:"XX XXX XXX"},{code:"+218",label:"Libya",flag:"\uD83C\uDDF1\uD83C\uDDFE",example:"91 234 5678",format:"XX XXX XXXX"},{code:"+220",label:"Gambia",flag:"\uD83C\uDDEC\uD83C\uDDF2",example:"301 2345",format:"XXX XXXX"},{code:"+221",label:"Senegal",flag:"\uD83C\uDDF8\uD83C\uDDF3",example:"70 123 45 67",format:"XX XXX XX XX"},{code:"+223",label:"Mali",flag:"\uD83C\uDDF2\uD83C\uDDF1",example:"65 01 23 45",format:"XX XX XX XX"},{code:"+225",label:"C\xf4te d'Ivoire",flag:"\uD83C\uDDE8\uD83C\uDDEE",example:"01 23 45 67",format:"XX XX XX XX"},{code:"+227",label:"Niger",flag:"\uD83C\uDDF3\uD83C\uDDEA",example:"90 12 34 56",format:"XX XX XX XX"},{code:"+229",label:"Benin",flag:"\uD83C\uDDE7\uD83C\uDDEF",example:"90 12 34 56",format:"XX XX XX XX"},{code:"+231",label:"Liberia",flag:"\uD83C\uDDF1\uD83C\uDDF7",example:"4 123 4567",format:"X XXX XXXX"},{code:"+233",label:"Ghana",flag:"\uD83C\uDDEC\uD83C\uDDED",example:"23 123 4567",format:"XX XXX XXXX"},{code:"+234",label:"Nigeria",flag:"\uD83C\uDDF3\uD83C\uDDEC",example:"701 234 5678",format:"XXX XXX XXXX"},{code:"+237",label:"Cameroon",flag:"\uD83C\uDDE8\uD83C\uDDF2",example:"6 71 23 45 67",format:"X XX XX XX XX"},{code:"+241",label:"Gabon",flag:"\uD83C\uDDEC\uD83C\uDDE6",example:"06 03 12 34",format:"XX XX XX XX"},{code:"+243",label:"DR Congo",flag:"\uD83C\uDDE8\uD83C\uDDE9",example:"991 234 567",format:"XXX XXX XXX"},{code:"+244",label:"Angola",flag:"\uD83C\uDDE6\uD83C\uDDF4",example:"923 123 456",format:"XXX XXX XXX"},{code:"+250",label:"Rwanda",flag:"\uD83C\uDDF7\uD83C\uDDFC",example:"720 123 456",format:"XXX XXX XXX"},{code:"+251",label:"Ethiopia",flag:"\uD83C\uDDEA\uD83C\uDDF9",example:"91 123 4567",format:"XX XXX XXXX"},{code:"+254",label:"Kenya",flag:"\uD83C\uDDF0\uD83C\uDDEA",example:"712 345 678",format:"XXX XXX XXX"},{code:"+255",label:"Tanzania",flag:"\uD83C\uDDF9\uD83C\uDDFF",example:"621 234 567",format:"XXX XXX XXX"},{code:"+256",label:"Uganda",flag:"\uD83C\uDDFA\uD83C\uDDEC",example:"712 345 678",format:"XXX XXX XXX"},{code:"+260",label:"Zambia",flag:"\uD83C\uDDFF\uD83C\uDDF2",example:"95 5123456",format:"XX XXXXXXX"},{code:"+263",label:"Zimbabwe",flag:"\uD83C\uDDFF\uD83C\uDDFC",example:"71 234 5678",format:"XX XXX XXXX"},{code:"+264",label:"Namibia",flag:"\uD83C\uDDF3\uD83C\uDDE6",example:"81 123 4567",format:"XX XXX XXXX"},{code:"+265",label:"Malawi",flag:"\uD83C\uDDF2\uD83C\uDDFC",example:"991 234 567",format:"XXX XXX XXX"},{code:"+266",label:"Lesotho",flag:"\uD83C\uDDF1\uD83C\uDDF8",example:"5012 3456",format:"XXXX XXXX"},{code:"+267",label:"Botswana",flag:"\uD83C\uDDE7\uD83C\uDDFC",example:"71 123 456",format:"XX XXX XXX"},{code:"+268",label:"Eswatini",flag:"\uD83C\uDDF8\uD83C\uDDFF",example:"7612 3456",format:"XXXX XXXX"},{code:"+27",label:"South Africa",flag:"\uD83C\uDDFF\uD83C\uDDE6",example:"71 123 4567",format:"XX XXX XXXX"}]},w=[...D.common,...D.caribbean,...D.latinAmerica,...D.africa];function k(e){var t,a;let{name:s,label:l,required:i=!1,placeholder:c="",helpText:u="Enter your phone number with country code"}=e,{control:d,formState:{errors:m},setValue:p,getValues:g}=(0,o.Gc)(),[h,b]=(0,r.useState)("+1"),[f,k]=(0,r.useState)(""),[_,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(f){let e="".concat(h).concat(f);p(s,e,{shouldValidate:!0})}else p(s,"",{shouldValidate:!1})},[h,f,s,p]);let X=()=>{let e=w.find(e=>e.code===h);if(e)return{example:e.example,format:e.format,flag:e.flag,label:e.label};try{let e=h.replace("+",""),t=(0,x.L)(e.substring(0,2),y.Z);return{example:t?t.formatNational():"555-1234",format:"XXX-XXXX",flag:"\uD83C\uDF0D",label:"International"}}catch(e){return{example:"555-1234",format:"XXX-XXXX",flag:"\uD83C\uDF0D",label:"International"}}},N=e=>{if(!e)return"";try{let t=(0,v.S)(e);if(t)return t.nationalNumber}catch(e){}let t=[...w].sort((e,t)=>t.code.length-e.code.length);for(let a of t)if(e.startsWith(a.code))return e.substring(a.code.length).replace(/\D/g,"");return e.replace(/\D/g,"")};return(0,r.useEffect)(()=>{(()=>{let e=g(s);if(!e)return;try{let t=(0,v.S)(e);if(t&&t.countryCallingCode){let e="+".concat(t.countryCallingCode);b(e),k(t.nationalNumber||"");return}}catch(e){}let t=[...w].sort((e,t)=>t.code.length-e.code.length);for(let a of t)if(e.startsWith(a.code)){b(a.code),k(N(e));return}k(e.replace(/\D/g,""))})()},[]),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{htmlFor:s,className:"form-label",children:[l,i&&(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,n.jsx)("div",{className:"relative",children:(0,n.jsxs)("div",{className:"flex rounded-lg border border-gray-300 focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500 overflow-hidden transition-colors",children:[(0,n.jsxs)("div",{className:"flex-shrink-0 bg-gray-50 border-r border-gray-300 flex items-center relative",children:[(0,n.jsxs)("select",{className:"bg-transparent appearance-none pl-2 pr-6 py-3 text-sm font-medium focus:outline-none max-w-[100px] sm:max-w-none",value:h,onChange:e=>{b(e.target.value)},"aria-label":"Country code",children:[(0,n.jsx)("optgroup",{label:"Most Common",children:D.common.map(e=>(0,n.jsxs)("option",{value:e.code,children:[e.flag," ",e.code]},e.code))}),(0,n.jsx)("optgroup",{label:"Caribbean",children:D.caribbean.map(e=>(0,n.jsxs)("option",{value:e.code,children:[e.flag," ",e.code]},e.code))}),(0,n.jsx)("optgroup",{label:"Central & South America",children:D.latinAmerica.map(e=>(0,n.jsxs)("option",{value:e.code,children:[e.flag," ",e.code]},e.code))}),(0,n.jsx)("optgroup",{label:"Africa",children:D.africa.map(e=>(0,n.jsxs)("option",{value:e.code,children:[e.flag," ",e.code]},e.code))})]}),(0,n.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-0.5",children:(0,n.jsx)("svg",{className:"h-3 w-3 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,n.jsx)("input",{id:s,type:"tel",className:"block w-full px-4 py-3 focus:outline-none border-0 shadow-none bg-white",placeholder:X().example,onFocus:()=>j(!0),onBlur:()=>j(!1),value:(e=>{if(!e)return"";try{if(e.length<=4)return e;if(e.length<=7)return"".concat(e.substring(0,3),"-").concat(e.substring(3));{if(10===e.length)return"(".concat(e.substring(0,3),") ").concat(e.substring(3,6),"-").concat(e.substring(6));let t=[],a=e;for(;a.length>3;)t.push(a.substring(0,3)),a=a.substring(3);return a&&t.push(a),t.join("-")}}catch(t){return e}})(f),onChange:e=>{let t=e.target.value.replace(/\D/g,"");k(t)},"aria-required":i,"aria-invalid":m[s]?"true":"false"}),f&&(e=>{if(!e)return!1;try{let t=(0,v.S)(e);return!!t&&t.isValid()}catch(e){return!1}})("".concat(h).concat(f))&&(0,n.jsx)("div",{className:"flex-shrink-0 flex items-center pr-3",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})}),(0,n.jsx)(o.Qr,{name:s,control:d,render:e=>{let{field:t}=e;return(0,n.jsx)("input",{type:"hidden",...t})}}),m[s]?(0,n.jsx)("p",{className:"form-error mt-1",role:"alert",id:"".concat(s,"-error"),children:null===(a=m[s])||void 0===a?void 0:null===(t=a.message)||void 0===t?void 0:t.toString()}):_&&!f?(0,n.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["Format: ",X().flag," ",X().format]}):null]})}let _=e=>{var t,a;let{currentStep:r,setCurrentStep:s}=e,{register:l,formState:{errors:i},trigger:c,watch:u,setValue:d}=(0,o.Gc)();if(1!==r)return null;let m=async()=>{let e=u("name"),t=u("phone"),a=u("email"),n=!0;(!e||e.length<2)&&(d("name",e||"",{shouldValidate:!0}),n=!1),t&&/^\+?[0-9]{10,15}$/.test(t)||(d("phone",t||"",{shouldValidate:!0}),n=!1),a&&a.length>0&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)&&(d("email",a||"",{shouldValidate:!0}),n=!1),await c(["name","phone","email"]),n&&s(2)};return(0,n.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Personal Information"}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{htmlFor:"name",className:"form-label",children:["Full Name",(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,n.jsx)("input",{id:"name",type:"text",placeholder:"John Doe",...l("name"),className:"form-input input-with-icon","aria-required":"true","aria-invalid":i.name?"true":"false"})]}),i.name&&(0,n.jsx)("p",{className:"form-error",role:"alert",id:"name-error",children:null===(t=i.name.message)||void 0===t?void 0:t.toString()})]}),(0,n.jsx)(k,{name:"phone",label:"Phone Number",required:!0,placeholder:"+1 (555) 123-4567",helpText:"Enter your phone number with country code"}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{htmlFor:"email",className:"form-label",children:["Email Address",(0,n.jsx)("span",{className:"text-gray-400 text-xs ml-2",children:"(Optional)"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,n.jsx)("input",{id:"email",type:"email",...l("email"),className:"form-input input-with-icon",placeholder:"your.email@example.com","aria-invalid":i.email?"true":"false"})]}),i.email&&(0,n.jsx)("p",{className:"form-error",role:"alert",id:"email-error",children:null===(a=i.email.message)||void 0===a?void 0:a.toString()})]}),(0,n.jsx)("div",{className:"flex justify-end mt-8",children:(0,n.jsxs)("button",{type:"button",onClick:m,className:"form-btn flex items-center","aria-label":"Continue to next step",children:[(0,n.jsx)("span",{children:"Continue"}),(0,n.jsx)("svg",{className:"ml-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]})},j=e=>{var t;let{currentStep:a,setCurrentStep:r}=e,{setValue:s,formState:{errors:l},clearErrors:i}=(0,o.Gc)();if(2!==a)return null;let c=e=>{s("account_type",e,{shouldValidate:!0}),i(["business_name","business_address"]),"personal"===e?r(5):r(3)};return(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Account Type"}),(0,n.jsx)("p",{className:"mb-4",children:"What type of account would you like to create?"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 mb-6",children:[(0,n.jsxs)("button",{type:"button",onClick:()=>c("personal"),className:"p-6 border border-gray-200 rounded-xl hover:border-blue-300 hover:bg-blue-50 focus:border-blue-500 transition-colors flex flex-col items-center justify-center shadow-sm hover:shadow group","aria-label":"Select Personal account type",children:[(0,n.jsx)("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mb-4 group-hover:bg-blue-200 transition-colors",children:(0,n.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,n.jsx)("span",{className:"font-medium mb-2 text-gray-800",children:"Personal"}),(0,n.jsx)("span",{className:"text-sm text-gray-500 text-center",children:"For individual use, no additional info needed"})]}),(0,n.jsxs)("button",{type:"button",onClick:()=>c("business"),className:"p-6 border border-gray-200 rounded-xl hover:border-blue-300 hover:bg-blue-50 focus:border-blue-500 transition-colors flex flex-col items-center justify-center shadow-sm hover:shadow group","aria-label":"Select Professional account type",children:[(0,n.jsx)("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mb-4 group-hover:bg-blue-200 transition-colors",children:(0,n.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,n.jsx)("span",{className:"font-medium mb-2 text-gray-800",children:"Pro"}),(0,n.jsx)("span",{className:"text-sm text-gray-500 text-center",children:"Accept payments as a Pro Flashpoint. Business Name & Address required"})]}),(0,n.jsxs)("button",{type:"button",onClick:()=>{console.log("Setting account type to merchant"),c("merchant")},className:"p-6 border border-gray-200 rounded-xl hover:border-blue-300 hover:bg-blue-50 focus:border-blue-500 transition-colors flex flex-col items-center justify-center shadow-sm hover:shadow group","aria-label":"Select Merchant account type",children:[(0,n.jsx)("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mb-4 group-hover:bg-blue-200 transition-colors",children:(0,n.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})})}),(0,n.jsx)("span",{className:"font-medium mb-2 text-gray-800",children:"Merchant"}),(0,n.jsx)("span",{className:"text-sm text-gray-500 text-center",children:"Give rewards as a Merchant Flashpoint. ID and Bank account info required"})]})]}),l.account_type&&(0,n.jsx)("p",{className:"form-error",children:null===(t=l.account_type.message)||void 0===t?void 0:t.toString()}),(0,n.jsx)("div",{className:"flex justify-between mt-6",children:(0,n.jsx)("button",{type:"button",onClick:()=>r(1),className:"form-btn-secondary",children:"Back"})})]})},X=e=>{var t;let{currentStep:a,setCurrentStep:r}=e,{register:s,formState:{errors:l},watch:i,setValue:c}=(0,o.Gc)(),u=i("account_type");return 5!==a?null:(0,n.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Terms and Conditions"}),(0,n.jsxs)("div",{className:"bg-blue-50 p-6 rounded-lg mb-6 max-h-60 overflow-y-auto text-sm border border-blue-100 shadow-sm",children:[(0,n.jsx)("p",{className:"font-medium text-gray-800 mb-4",children:"By checking the box below, you agree to our Terms of Service and Privacy Policy."}),(0,n.jsx)("p",{className:"mb-3 text-gray-700",children:"These terms include:"}),(0,n.jsxs)("ul",{className:"list-disc ml-5 space-y-2 text-gray-700",children:[(0,n.jsx)("li",{children:"Flash will collect and store the information you provide."}),(0,n.jsx)("li",{children:"You certify that the information provided is accurate and complete."}),(0,n.jsx)("li",{children:"You authorize Flash to conduct necessary verification procedures."}),(0,n.jsx)("li",{children:"For merchant accounts, you agree to comply with all applicable laws and regulations related to payment processing."}),(0,n.jsx)("li",{children:"Flash may update these terms from time to time. You will be notified of any significant changes."})]}),(0,n.jsx)("div",{className:"mt-4 pt-4 border-t border-blue-200",children:(0,n.jsxs)("p",{className:"text-gray-700",children:["For the complete terms, please visit our"," ",(0,n.jsx)("a",{href:"https://getflash.io/legal/terms.html",className:"text-blue-600 hover:underline",children:"Terms of Service"})," ","and"," ",(0,n.jsx)("a",{href:"https://getflash.io/legal/privacy.html",className:"text-blue-600 hover:underline",children:"Privacy Policy"}),"."]})})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"flex items-start cursor-pointer group",children:(0,n.jsxs)("div",{className:"relative flex items-start",children:[(0,n.jsx)("div",{className:"flex items-center h-5",children:(0,n.jsx)("input",{type:"checkbox",id:"terms_accepted",...s("terms_accepted"),className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 transition-colors","aria-describedby":"terms-description","aria-required":"true","aria-invalid":l.terms_accepted?"true":"false"})}),(0,n.jsxs)("div",{className:"ml-3 text-sm",children:[(0,n.jsxs)("label",{htmlFor:"terms_accepted",className:"font-medium text-gray-700 cursor-pointer group-hover:text-gray-900",children:["I agree to the Terms of Service and Privacy Policy",(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,n.jsx)("p",{id:"terms-description",className:"text-gray-500 mt-1",children:"By checking this box, you are creating a legally binding agreement."})]})]})}),l.terms_accepted&&(0,n.jsx)("p",{className:"form-error mt-2",role:"alert",children:null===(t=l.terms_accepted.message)||void 0===t?void 0:t.toString()})]}),(0,n.jsxs)("div",{className:"mt-8 flex justify-between",children:[(0,n.jsxs)("button",{type:"button",onClick:()=>{"personal"===u?r(2):"business"===u?r(3):"merchant"===u?r(4):r(2)},className:"form-btn-secondary flex items-center","aria-label":"Go back to previous step",children:[(0,n.jsx)("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),(0,n.jsx)("span",{children:"Back"})]}),(0,n.jsx)("button",{type:"button",className:"form-btn group relative flex items-center","aria-label":"Submit signup form",onClick:()=>{console.log("Submit button clicked");let e=i();console.log("Current form values:",e),c("terms_accepted",!0,{shouldValidate:!1});let t=document.querySelector("form");t?(console.log("Form found, submitting..."),t.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))):console.error("Form element not found")},children:(0,n.jsxs)("span",{className:"flex items-center",children:["Submit Application",(0,n.jsx)("svg",{className:"ml-2 h-5 w-5 group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})})]})]})};class N{logApiKeyStatus(e){let t=window.googleMapsApiKey,a=window.ENV&&window.ENV.GOOGLE_MAPS_API_KEY,n=e||"";n||(n="AIzaSyBNsBzd5AeJFz6aVELYIfGkYAH5_WFE4lc"),!n&&a?n=a:!n&&t&&(n=t);let r="not set",o="env";e?o="custom":t&&n===t?o="window":a&&n===a&&(o="window.ENV"),n&&(r="YOUR_GOOGLE_MAPS_API_KEY_HERE"===n?"placeholder":n.length>10?"valid":"invalid");let s="Google Maps API key status: ".concat(r),l={buildTime:!0,environment:"production",context:"client",keySource:o,hasWindowKey:!!t||!!a,hasWindowEnvKey:!!a,windowENVExists:!!window.ENV,keyPresent:!!n,keyLength:n?n.length:0};g.k.info(s,l)}logScriptLoading(e,t){e?(g.k.info("Google Maps script loaded successfully",{component:"GoogleMaps",action:"scriptLoad"}),this.options.verbose&&console.info("\uD83D\uDDFA️ Google Maps script loaded successfully")):(g.k.error("Google Maps script failed to load",t),this.options.verbose&&console.error("❌ Google Maps script failed to load",t))}logPlacesInitialization(e,t){e?(g.k.info("Google Places API initialized successfully",{component:"GoogleMaps",action:"placesInit"}),this.options.verbose&&console.info("\uD83D\uDDFA️ Google Places API initialized successfully")):(g.k.error("Google Places API failed to initialize",t),this.options.verbose&&console.error("❌ Google Places API failed to initialize",t))}logPlaceSelection(e,t,a){g.k.info("Place selected from autocomplete",{component:"GoogleMaps",action:"placeSelect",placeId:e,hasAddress:!!t,hasGeometry:a,address:t?"".concat(t.substring(0,10),"..."):void 0}),this.options.verbose&&console.info("\uD83D\uDDFA️ Place selected: ".concat(t||"Unknown"," ").concat(a?"(with coordinates)":"(no coordinates)"))}logMapLoading(e,t){e?(g.k.info("Google Map component loaded successfully",{component:"GoogleMaps",action:"mapLoad"}),this.options.verbose&&console.info("\uD83D\uDDFA️ Google Map component loaded successfully")):(g.k.error("Google Map component failed to load",t),this.options.verbose&&console.error("❌ Google Map component failed to load",t))}logCorsIssue(e){let t=e instanceof Error?e.message:"string"==typeof e?e:"Unknown CORS error";g.k.error("Google Maps CORS issue detected",{component:"GoogleMaps",action:"corsError",error:t,origin:window.location.origin,staticBuild:!0,referrer:"undefined"!=typeof document?document.referrer:"unknown",userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown"})}constructor(e={}){this.options={debugKeyVisibility:!1,verbose:!0,...e}}}let S=new N,C={libraries:["places"],version:"weekly",language:"en"},E={scriptLoaded:!1,scriptLoading:!1,scriptLoadError:!1,status:"idle",googleMapsScript:null};function A(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,[t,a]=(0,r.useState)(E.status),[n,o]=(0,r.useState)(null),s=window.googleMapsApiKey,l=window.ENV&&window.ENV.GOOGLE_MAPS_API_KEY,i="AIzaSyBNsBzd5AeJFz6aVELYIfGkYAH5_WFE4lc",c=s||l||i,u=c?"YOUR_GOOGLE_MAPS_API_KEY_HERE"===c?"placeholder":c.length>8?"".concat(c.substring(0,2),"...").concat(c.substring(c.length-2)):"masked":"missing",d=!!c&&""!==c.trim(),m="YOUR_GOOGLE_MAPS_API_KEY_HERE"===c,p=d&&!m;(0,r.useEffect)(()=>{},[!1,s,l,i,u,p,!0]),(0,r.useEffect)(()=>{if(window.google&&window.google.maps){E.scriptLoaded=!0,E.status="ready",a("ready");return}if(E.scriptLoaded){a("ready");return}if(E.scriptLoadError){a("error");return}if(E.scriptLoading){a("loading");return}if(!p){let e=d?"invalid-key":"no-key";a(e),E.status=e}S.logApiKeyStatus(c)},[d,p,c]),(0,r.useEffect)(()=>{let e=e=>{e.message&&(e.message.includes("google")||e.message.includes("maps")||e.message.includes("googleapis"))&&S.logCorsIssue(e)};return window.addEventListener("error",e),()=>{window.removeEventListener("error",e)}},[]);let g=(0,r.useCallback)(()=>{if(!E.scriptLoaded&&!E.scriptLoading)try{E.scriptLoading=!0,a("loading"),E.googleMapsScript&&(document.head.removeChild(E.googleMapsScript),E.googleMapsScript=null);let e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?libraries=places",e.async=!0,e.defer=!0,e.crossOrigin="anonymous",e.id="google-maps-script-no-key",e.onload=()=>{E.scriptLoaded=!0,E.scriptLoading=!1,E.status="ready",a("ready")},e.onerror=e=>{let t=Error("Failed to load Google Maps script without API key");E.scriptLoadError=!0,E.scriptLoading=!1,E.status="error",a("error"),o(t)},document.head.appendChild(e),E.googleMapsScript=e}catch(t){let e=t instanceof Error?t:Error("Unknown error loading Google Maps script");E.scriptLoadError=!0,E.scriptLoading=!1,E.status="error",a("error"),o(e)}},[!1]),h=(0,r.useCallback)(()=>{if(console.log("\uD83D\uDDFA️ Start loading Google Maps script:",{globalScriptLoaded:E.scriptLoaded,globalScriptLoading:E.scriptLoading,globalScriptError:E.scriptLoadError,apiKeySource:c?s?"window":l?"window.ENV":"env variable":"none",apiKeyLength:c?c.length:0,isStatic:!0,inBrowser:!0}),E.scriptLoaded||E.scriptLoading||E.scriptLoadError){console.log("\uD83D\uDDFA️ Maps script already being handled, state:",E.status),a(E.status);return}if(window.google&&window.google.maps){E.scriptLoaded=!0,E.status="ready",a("ready"),S.logScriptLoading(!0);return}if(!p){let e=Error("Google Maps API key missing or invalid (".concat(u,")"));o(e),S.logScriptLoading(!1,e);let t=d?"invalid-key":"no-key";E.status=t,a(t);return}try{var t;E.scriptLoading=!0,E.status="loading",a("loading"),E.googleMapsScript&&(document.head.removeChild(E.googleMapsScript),E.googleMapsScript=null);let n=(null===(t=e.libraries)||void 0===t?void 0:t.join(","))||"places",r=e.version||"weekly",s=new URLSearchParams({key:c,v:r,libraries:n,callback:"googleMapsCallback",nonce:"google-maps-nonce",...e.language?{language:e.language}:{},...e.region?{region:e.region}:{}});window.googleMapsCallback=function(){console.log("\uD83D\uDDFA️ Google Maps API loaded via callback"),window.google&&window.google.maps&&(E.scriptLoaded=!0,E.scriptLoading=!1,E.status="ready",a("ready"),o(null),S.logScriptLoading(!0))};let l="https://maps.googleapis.com/maps/api/js?".concat(s.toString()),i=document.createElement("script");i.src=l,i.async=!0,i.defer=!0,i.crossOrigin="anonymous",i.id="google-maps-script",i.onload=()=>{if(window.google&&window.google.maps)E.scriptLoaded=!0,E.scriptLoading=!1,E.status="ready",a("ready"),o(null),S.logScriptLoading(!0);else{let e=Error("Google Maps API loaded but not available");E.scriptLoadError=!0,E.scriptLoading=!1,E.status="error",a("error"),o(e),S.logScriptLoading(!1,e)}},i.onerror=e=>{let t=e instanceof Error?e:Error("Failed to load Google Maps script (".concat(u,")"));E.scriptLoadError=!0,E.scriptLoading=!1,E.status="error",a("error"),o(t),S.logScriptLoading(!1,t)},document.head.appendChild(i),E.googleMapsScript=i}catch(t){let e=t instanceof Error?t:Error("Unknown error loading Google Maps");E.scriptLoadError=!0,E.scriptLoading=!1,E.status="error",a("error"),o(e),S.logScriptLoading(!1,e)}},[c,u,d,p,!1,g,e.libraries,e.version,e.language,e.region]);return{status:t,error:n,isLoaded:"ready"===t,isError:["error","no-key","invalid-key"].includes(t),hasValidKey:p,apiKeyDebug:u,loadScript:h,loadWithoutKey:g}}var L=a(4748);let I={width:"100%",height:"200px",borderRadius:"8px",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24)"},F=e=>{let{latitude:t,longitude:a,isExpanded:o=!0,toggleExpand:s}=e,{status:l,isLoaded:i,hasValidKey:c,loadScript:u,error:d}=A(),[m,p]=(0,r.useState)(null),[g,h]=(0,r.useState)(null),b=()=>{var e;console.log("\uD83D\uDDFA️ Google Maps API Key Debug:"),console.log("- window.googleMapsApiKey:",!!window.googleMapsApiKey),console.log("- window.ENV?.GOOGLE_MAPS_API_KEY:",!!(null===(e=window.ENV)||void 0===e?void 0:e.GOOGLE_MAPS_API_KEY));let t="undefined"!=typeof document&&document.querySelector('meta[name="google-maps-api-key"]');console.log("- Meta tag present:",!!t),console.log("- Meta tag content:",t?t.getAttribute("content")?"has content":"empty content":"N/A"),console.log("- process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY:",!0);let a="undefined"!=typeof document&&document.getElementById("google-maps-script");console.log("- Google Maps script in DOM:",!!a),window.ENV?console.log("- window.ENV object:",Object.keys(window.ENV)):console.log("- window.ENV object: not found")};(0,r.useEffect)(()=>{b();let e=setTimeout(()=>{"loading"===l&&(console.warn("\uD83D\uDDFA️ Maps API loading timeout, might have CORS issues"),h("Maps loading timeout - please try again later"))},5e3);if(document.querySelector('meta[name="google-maps-api-key"]')){let e=document.querySelector('meta[name="google-maps-api-key"]'),t=null==e?void 0:e.getAttribute("content");t&&!window.googleMapsApiKey&&(console.log("\uD83D\uDDFA️ Setting window.googleMapsApiKey from meta tag"),window.googleMapsApiKey=t,window.ENV&&(console.log("\uD83D\uDDFA️ Setting window.ENV.GOOGLE_MAPS_API_KEY from meta tag"),window.ENV.GOOGLE_MAPS_API_KEY=t))}return u(),()=>clearTimeout(e)},[u,l]),(0,r.useEffect)(()=>{switch(l){case"loading":h("Loading map...");break;case"no-key":h("Maps not available - API key not configured");break;case"invalid-key":h("Maps not available - Invalid API key");break;case"error":h("Error loading map: ".concat((null==d?void 0:d.message)||"Unknown error"));break;case"ready":t&&a?(h(null),S.logMapLoading(!0)):h("Select an address to see the location on map")}},[l,d,t,a]);let f={lat:t||0,lng:a||0},x=(0,r.useCallback)(e=>{p(e)},[]),v=(0,r.useCallback)(()=>{p(null)},[]);if(!o)return(0,n.jsx)("div",{className:"w-full text-center",children:(0,n.jsx)("button",{type:"button",onClick:s,className:"text-blue-600 text-sm hover:text-blue-800 underline focus:outline-none",children:"Show map"})});let y=i&&t&&a;return y?(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(L.b6,{mapContainerStyle:I,center:f,zoom:15,onLoad:x,onUnmount:v,options:{disableDefaultUI:!0,zoomControl:!0,fullscreenControl:!0,mapTypeControl:!1,streetViewControl:!1},children:(0,n.jsx)(L.Jx,{position:f})}),s&&(0,n.jsx)("button",{type:"button",onClick:s,className:"absolute top-2 right-2 bg-white rounded-full p-1 shadow-md text-gray-700 hover:bg-gray-100","aria-label":"Hide map",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,n.jsx)("div",{className:"w-full h-[200px] bg-gray-100 rounded-lg flex flex-col items-center justify-center p-4",children:c||"loading"===l?(0,n.jsx)(n.Fragment,{children:"loading"===l?(0,n.jsxs)("div",{className:"animate-pulse flex space-x-2",children:[(0,n.jsx)("div",{className:"h-2 w-2 bg-blue-400 rounded-full"}),(0,n.jsx)("div",{className:"h-2 w-2 bg-blue-400 rounded-full"}),(0,n.jsx)("div",{className:"h-2 w-2 bg-blue-400 rounded-full"})]}):(0,n.jsx)("span",{className:"text-gray-500",children:g||"No location selected"})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{className:"h-8 w-8 text-amber-500 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,n.jsx)("span",{className:"text-gray-500 text-center",children:g||"Map unavailable"})]})})},M=e=>{var t;let{isRequired:a}=e,{register:s,setValue:l,formState:{errors:i},watch:c}=(0,o.Gc)(),u=(0,r.useRef)(null),d=(0,r.useRef)(null),[m,p]=(0,r.useState)(!1),[g,h]=(0,r.useState)(null),[b,f]=(0,r.useState)(!1),[x,v]=(0,r.useState)(!0),[y,D]=(0,r.useState)(!1),w=c("business_address"),k=c("latitude"),_=c("longitude");(0,r.useEffect)(()=>{k&&_&&(D(!0),p(!1),console.log("\uD83C\uDFD9️ Coordinates detected, marking address as selected:",{latitude:k,longitude:_}))},[k,_]);let{status:j,isLoaded:X,hasValidKey:N,loadScript:C}=A({libraries:["places"]});(0,r.useEffect)(()=>{C()},[C]),(0,r.useEffect)(()=>{switch(j){case"idle":case"loading":h("Loading address suggestions...");break;case"no-key":h("Address suggestions not available");break;case"invalid-key":h("Invalid Maps API configuration");break;case"error":h("Error loading address validation");break;case"ready":h(null)}},[j]),(0,r.useEffect)(()=>{if(console.log("\uD83C\uDFD9️ Address input initialization:",{isLoaded:X,hasInputRef:!!u.current,hasAutocompleteRef:!!d.current,status:j}),X&&u.current&&!d.current){try{d.current=new window.google.maps.places.Autocomplete(u.current,{types:["address"],fields:["address_components","formatted_address","geometry","geometry.location","place_id","name","vicinity"]}),S.logPlacesInitialization(!0),d.current.addListener("place_changed",()=>{if(d.current)try{var e,t;let a=d.current.getPlace();if(!a){console.warn("Place selection returned empty result");return}let n=!!(a&&a.geometry&&a.geometry.location),r=!!(a&&a.formatted_address),o=a&&a.formatted_address?a.formatted_address:"",s=a&&a.place_id?a.place_id:"";if(S.logPlaceSelection(s,o,n),console.log("\uD83C\uDFD9️ Place changed event triggered:",{placeId:s,hasGeometry:n,hasAddress:r,formattedAddress:o.substring(0,30)+"..."}),a&&a.place_id&&!n){console.log("\uD83C\uDFD9️ Using fallback coordinates for address without geometry");let t=a.formatted_address||(null===(e=u.current)||void 0===e?void 0:e.value)||"";t&&(l("business_address",t,{shouldValidate:!1}),l("latitude",18.1096,{shouldValidate:!1}),l("longitude",-77.2975,{shouldValidate:!1}),console.log("\uD83C\uDFD9️ Using fallback coordinates and address:",{lat:18.1096,lng:-77.2975,address:t}),p(!1),D(!0),v(!0),document.activeElement===u.current&&u.current&&u.current.blur())}else if(n&&r&&a.geometry&&a.geometry.location){console.log("\uD83C\uDFD9️ Using actual coordinates from place selection");let e=a.geometry.location.lat()||0,t=a.geometry.location.lng()||0;console.log("\uD83D\uDCCD Extracted coordinates:",{latitude:e,longitude:t,address:o}),l("business_address",o,{shouldValidate:!1}),l("latitude",e,{shouldValidate:!1}),l("longitude",t,{shouldValidate:!1}),p(!1),D(!0),v(!0),document.activeElement===u.current&&u.current&&u.current.blur(),setTimeout(()=>{console.log("\uD83D\uDCCD FORM VALUES AFTER SETTING:",{latitude:c("latitude"),longitude:c("longitude"),address:c("business_address")})},50)}else{console.warn("Address selection missing required data");let e=a.formatted_address||(null===(t=u.current)||void 0===t?void 0:t.value)||"";e&&(l("business_address",e,{shouldValidate:!0}),l("latitude",void 0,{shouldValidate:!1}),l("longitude",void 0,{shouldValidate:!1}))}}catch(e){console.error("Error handling place selection:",e)}})}catch(e){console.error("Failed to initialize Google Maps autocomplete:",e),S.logPlacesInitialization(!1,e instanceof Error?e:Error("Autocomplete initialization failed"))}return()=>{d.current=null}}},[X,l,c]);let{ref:E,onBlur:L,...I}=s("business_address");return(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"relative ".concat(b?"z-50":"z-10"),children:[(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-1 flex items-center",children:[(0,n.jsx)("svg",{className:"h-4 w-4 mr-1 text-blue-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"Start typing and select your address from the dropdown suggestions"]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute top-3 left-3 pointer-events-none",children:(0,n.jsxs)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,n.jsx)("input",{id:"business_address",className:"form-input input-with-icon py-3 text-base ".concat(!N&&"pr-12"," ").concat(b?"border-blue-500 ring-2 ring-blue-200":""),placeholder:a?"Enter your business address":"Optional for merchants","aria-required":a,"aria-invalid":i.business_address?"true":"false",onFocus:()=>{f(!0),y||p(!0)},onBlur:e=>{L&&L(e);let t=!!(k&&_);setTimeout(()=>{f(!1),t&&(D(!0),p(!1),console.log("\uD83D\uDCCD Blur handler: Found coordinates, marking address as selected"))},300)},ref:e=>{E(e),u.current=e},autoComplete:"off",...I,onChange:e=>{let t=e.target.value;p(!0),t!==w&&(console.log("\uD83D\uDCDD User typing new address text:",{oldValue:null==w?void 0:w.substring(0,20),newValue:null==t?void 0:t.substring(0,20)}),D(!1),(k||_)&&(console.log("\uD83D\uDCCD Clearing coordinates during user typing"),l("latitude",void 0,{shouldValidate:!1}),l("longitude",void 0,{shouldValidate:!1}))),l("business_address",t,{shouldValidate:t.length>5})}}),(!N||"error"===j)&&(0,n.jsx)("div",{className:"absolute top-3 right-3 pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})})]}),g&&(0,n.jsx)("div",{className:"mt-1 text-xs text-amber-600",children:g}),m&&X&&!g&&(0,n.jsxs)("div",{className:"mt-1 text-xs text-blue-600 flex items-center",children:[(0,n.jsx)("div",{className:"mr-1 h-2 w-2 bg-blue-600 rounded-full animate-pulse"}),"Type your address for suggestions..."]}),y&&w&&k&&_&&(0,n.jsxs)("div",{className:"mt-1 text-xs text-green-600 flex items-center",children:[(0,n.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,n.jsx)("span",{className:"font-medium",children:"Address verified"})," - map location shown below"]})]}),i.business_address&&(0,n.jsx)("p",{className:"text-red-500 text-sm",role:"alert",children:null===(t=i.business_address.message)||void 0===t?void 0:t.toString()}),w&&k&&_&&(0,n.jsxs)("div",{className:"mt-3 bg-gray-50 p-4 rounded-lg border border-gray-200",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Address Map Location"}),(0,n.jsx)("button",{type:"button",onClick:()=>v(!x),className:"text-sm text-blue-600 hover:text-blue-800 focus:outline-none flex items-center",children:x?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),"Hide Map"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),"Show Map"]})})]}),(0,n.jsx)(F,{latitude:k||null,longitude:_||null,isExpanded:x,toggleExpand:()=>v(!x)})]})]})},U=e=>{var t;let{currentStep:a,setCurrentStep:r}=e,{register:s,formState:{errors:l},watch:i,setValue:c}=(0,o.Gc)(),u=i("account_type");if(console.log("\uD83D\uDCBC BusinessInfoStep rendering, accountType:",u),3!==a)return null;let d="business"===u||"merchant"===u;return(0,n.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Business Information"}),(0,n.jsxs)("div",{className:"form-group mb-6",children:[(0,n.jsxs)("label",{htmlFor:"business_name",className:"form-label",children:["Business Name",(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),(0,n.jsx)("input",{id:"business_name",...s("business_name"),className:"form-input input-with-icon",placeholder:"Your business name","aria-required":d,"aria-invalid":l.business_name?"true":"false"})]}),l.business_name&&(0,n.jsx)("p",{className:"form-error",role:"alert",children:null===(t=l.business_name.message)||void 0===t?void 0:t.toString()})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{htmlFor:"business_address",className:"form-label",children:["Business Address",(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,n.jsx)(M,{isRequired:d})]}),(0,n.jsxs)("div",{className:"form-group mb-4 mt-6",children:[(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("div",{className:"flex items-center h-5",children:(0,n.jsx)("input",{id:"wants_terminal",type:"checkbox",checked:!!i("wants_terminal"),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",onChange:e=>{let t=e.target.checked;c("wants_terminal",!!t,{shouldValidate:!1}),console.log("\uD83D\uDCBB Terminal checkbox changed:",{isChecked:t,forcedBoolean:!!t,type:typeof!!t})}})}),(0,n.jsx)("div",{className:"ml-3 text-sm",children:(0,n.jsxs)("label",{htmlFor:"wants_terminal",className:"font-medium text-gray-700 flex items-center",children:["Do you want a Flash Terminal?",(0,n.jsxs)("div",{className:"relative ml-2 group",children:[(0,n.jsx)("svg",{className:"w-4 h-4 text-gray-500 cursor-pointer",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),(0,n.jsx)("div",{className:"absolute left-0 bottom-6 w-64 p-3 text-xs bg-gray-700 text-white rounded shadow-lg opacity-0 pointer-events-none group-hover:opacity-100 transition duration-150 ease-in-out z-50",children:"A Flash Terminal is a smartdevice that can accept payment via Flash for your business and print receipts. A customer service representative will contact you if you check this box."})]})]})})]}),!1]}),(0,n.jsxs)("div",{className:"mt-8 flex justify-between",children:[(0,n.jsxs)("button",{type:"button",onClick:()=>r(2),className:"form-btn-secondary flex items-center","aria-label":"Go back to previous step",children:[(0,n.jsx)("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),(0,n.jsx)("span",{children:"Back"})]}),(0,n.jsx)("div",{className:"flex space-x-3",children:(0,n.jsxs)("button",{type:"button",onClick:()=>{let e=i("wants_terminal");if(console.log("\uD83D\uDCBB Terminal checkbox state before validation:",{wantsTerminal:e,type:typeof e,checked:!!e,forcedBoolean:!!e}),c("wants_terminal",!!e,{shouldValidate:!1}),console.log("\uD83D\uDCBB Terminal checkbox state AFTER forcing boolean:",{wantsTerminal:i("wants_terminal"),type:typeof i("wants_terminal")}),"merchant"===u){let t=i("business_name"),a=i("business_address"),n=!0;(!t||t.length<2)&&(n=!1,c("business_name",t||"",{shouldValidate:!0})),(!a||a.length<5)&&(n=!1,c("business_address",a||"",{shouldValidate:!0})),n&&(void 0!==e&&c("wants_terminal",!!e,{shouldValidate:!1}),r(4))}else if("business"===u){let t=i("business_name"),a=i("business_address"),n=!0;(!t||t.length<2)&&(n=!1,c("business_name",t||"",{shouldValidate:!0})),(!a||a.length<5)&&(n=!1,c("business_address",a||"",{shouldValidate:!0})),n&&(void 0!==e&&c("wants_terminal",!!e,{shouldValidate:!1}),r(4))}else void 0!==e&&c("wants_terminal",!!e,{shouldValidate:!1}),r(5)},className:"form-btn flex items-center","aria-label":"Continue to next step",children:[(0,n.jsx)("span",{children:"Continue"}),(0,n.jsx)("svg",{className:"ml-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]})]})};var P=a(274);function z(){var e;let[t,a]=(0,r.useState)(!1),[s,l]=(0,r.useState)(null),[i,c]=(0,r.useState)("idle"),[u,d]=(0,r.useState)(null),{setValue:m,register:g,formState:{errors:h},clearErrors:b,watch:f}=(0,o.Gc)(),x=(0,r.useRef)(null),v=(0,r.useRef)(null),y=f("account_type"),D="merchant"===y,{credentials:w,loading:k,error:_,hookId:j}=function(){let[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)(!0),[o,s]=(0,r.useState)(null),l=(0,r.useRef)("hook_".concat(Date.now().toString(36),"_").concat(Math.random().toString(36).substring(2,5)));return(0,r.useRef)(0),(0,r.useEffect)(()=>{let e=l.current;return console.info("[\uD83D\uDD11] [".concat(e,"] useCredentials hook initialized")),()=>{console.info("[\uD83D\uDD11] [".concat(e,"] useCredentials hook cleanup"))}},[]),(0,r.useEffect)(()=>{if(window.ENV&&window.ENV.SUPABASE_URL&&window.ENV.SUPABASE_KEY){console.info("[\uD83D\uDD11] [".concat(l.current,"] Using credentials from window.ENV (static deployment)")),t({supabaseUrl:window.ENV.SUPABASE_URL,supabaseKey:window.ENV.SUPABASE_KEY,bucket:"id_uploads",environment:"production",buildTime:!0,platform:"StaticDeployment",traceId:"static_".concat(Date.now().toString(36)),serverTime:new Date().toISOString()}),n(!1);return}console.info("[\uD83D\uDD11] [".concat(l.current,"] Using embedded static credentials (build time)")),t({supabaseUrl:"https://uygbqnrqwjvzdfbqeipf.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5Z2JxbnJxd2p2emRmYnFlaXBmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMTA5NzQsImV4cCI6MjA2MDU4Njk3NH0._galk7m0xPn_HUctiSbPw5fdWU7jyI5La-Xtm6zAt9g",bucket:"id_uploads",environment:"production",buildTime:!0,platform:"StaticBuild",traceId:"static_".concat(Date.now().toString(36)),serverTime:new Date().toISOString()}),n(!1)},[o,null==e?void 0:e.supabaseUrl]),{credentials:e,loading:a,error:o,hookId:l.current}}(),X=(0,r.useRef)("upload_".concat(Date.now().toString(36),"_").concat(Math.random().toString(36).substring(2,5))),N=["image/jpeg","image/png","image/jpg","image/heic"],S=(0,r.useCallback)(async e=>{let t="".concat(X.current,"_").concat(Date.now().toString(36));try{var n,r,o,s,u,g,h,f,x;let i;if(console.info("[\uD83D\uDCE4] [".concat(t,"] Starting file upload process")),d(null),c("idle"),0===e.length){console.info("[\uD83D\uDCE4] [".concat(t,"] No files selected, aborting upload"));return}let v=e[0];if(!v){console.warn("[\uD83D\uDCE4] [".concat(t,"] File object is null/undefined, aborting"));return}if(!N.includes(v.type)){console.warn("[\uD83D\uDCE4] [".concat(t,"] Invalid file type: ").concat(v.type)),d("Please upload a valid image (JPG, PNG, or HEIC)");return}if(v.size>5242880){console.warn("[\uD83D\uDCE4] [".concat(t,"] File too large: ").concat((v.size/1024/1024).toFixed(2),"MB (max: ").concat(5,"MB)")),d("File size exceeds 5MB limit");return}console.info("[\uD83D\uDCE4] [".concat(t,"] Processing file:"),{name:v.name,type:v.type,size:"".concat((v.size/1024).toFixed(2),"KB"),lastModified:new Date(v.lastModified).toISOString()}),a(!0);let y=new FileReader;y.onload=e=>{var a;(null===(a=e.target)||void 0===a?void 0:a.result)&&(l(e.target.result),console.info("[\uD83D\uDCE4] [".concat(t,"] File preview created")))},y.readAsDataURL(v);let D=v.name.split(".").pop(),X=Date.now().toString(36),S=crypto.getRandomValues(new Uint8Array(8)).reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),C=crypto.getRandomValues(new Uint8Array(4)).reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),E=crypto.getRandomValues(new Uint8Array(4)).reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),A=crypto.getRandomValues(new Uint8Array(12)).reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),L="".concat(S,"-").concat(C,"-").concat(E,"-").concat(A,"-").concat(X),I="".concat(L,".").concat(D),F="".concat(I);console.info("[\uD83D\uDCE4] [".concat(t,"] Generated file path: ").concat(F));try{let e;if(console.info("[\uD83D\uDCE4] [".concat(t,"] STEP 1: Verifying credentials from hook (ID: ").concat(j,")")),k){console.warn("[\uD83D\uDCE4] [".concat(t,"] ⏳ Credentials still loading, waiting..."));try{await new Promise((e,t)=>{let a=setTimeout(()=>{t(Error("Timeout waiting for credentials"))},3e3),n=()=>{k?setTimeout(n,300):(clearTimeout(a),e(!0))};n()}),console.info("[\uD83D\uDCE4] [".concat(t,"] ✓ Credentials finished loading"))}catch(e){console.error("[\uD83D\uDCE4] [".concat(t,"] ⚠️ Timed out waiting for credentials"))}}let a={uploadId:t,hookId:j,timestamp:new Date().toISOString(),fileType:v.type,fileSize:v.size,fileName:v.name,credentialsLoading:k,credentialsError:_?{message:_.message,name:_.name}:null,hasCredentialsObject:!!w,hasUrl:!!(null==w?void 0:w.supabaseUrl),hasKey:!!(null==w?void 0:w.supabaseKey),urlLength:(null==w?void 0:null===(n=w.supabaseUrl)||void 0===n?void 0:n.length)||0,keyLength:(null==w?void 0:null===(r=w.supabaseKey)||void 0===r?void 0:r.length)||0,urlFirstChars:(null==w?void 0:w.supabaseUrl)?w.supabaseUrl.substring(0,8):"",credTraceId:(null==w?void 0:w.traceId)||"none",serverTime:null==w?void 0:w.serverTime,timeSinceServerResponse:(null==w?void 0:w.serverTime)?"".concat((new Date().getTime()-new Date(w.serverTime).getTime())/1e3,"s"):"unknown",bucket:(null==w?void 0:w.bucket)||p.v.supabase.storageBucket,environment:"production",platform:(null==w?void 0:w.platform)||"unknown",buildTime:"true",configHasSupabaseUrl:!!p.v.supabase.url,configHasSupabaseKey:!!p.v.supabase.anonKey,configSupabaseUrlLength:(null===(o=p.v.supabase.url)||void 0===o?void 0:o.length)||0,configSupabaseKeyLength:(null===(s=p.v.supabase.anonKey)||void 0===s?void 0:s.length)||0};console.info("[\uD83D\uDCE4] [".concat(t,"] \uD83D\uDCCB Comprehensive credential status:"),a),console.info("[\uD83D\uDCE4] [".concat(t,"] STEP 2: Initializing Supabase client"));let l=(null==w?void 0:w.bucket)||p.v.supabase.storageBucket,c="unknown";if((null==w?void 0:w.supabaseUrl)&&(null==w?void 0:w.supabaseKey)){console.info("[\uD83D\uDCE4] [".concat(t,"] ✅ Using real Supabase client with credentials from API response")),c="real_from_api";try{if(console.info("[\uD83D\uDCE4] [".concat(t,"] Creating Supabase client with valid credentials:"),{urlLength:w.supabaseUrl.length,keyLength:w.supabaseKey.length,bucket:l}),!(e=(0,P.Ng)(w.supabaseUrl,w.supabaseKey)))throw Error("getSupabaseClient returned null or undefined");console.info("[\uD83D\uDCE4] [".concat(t,"] ✓ Supabase client created successfully"))}catch(a){c="mock_after_client_error",console.error("[\uD83D\uDCE4] [".concat(t,"] ❌ Failed to create Supabase client:"),{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?(null===(u=a.stack)||void 0===u?void 0:u.substring(0,150))+"...":"No stack trace"}),console.warn("[\uD83D\uDCE4] [".concat(t,"] ⚠️ Falling back to mock client after client creation error")),e=(0,P.LZ)()}}else if(p.v.supabase.url&&p.v.supabase.anonKey){console.warn("[\uD83D\uDCE4] [".concat(t,"] ⚠️ API credentials missing, falling back to config.supabase values")),c="real_from_config";try{e=(0,P.Ng)(p.v.supabase.url,p.v.supabase.anonKey),console.info("[\uD83D\uDCE4] [".concat(t,"] ✓ Created fallback Supabase client from config"))}catch(a){c="mock_after_fallback_error",console.error("[\uD83D\uDCE4] [".concat(t,"] ❌ Failed to create fallback Supabase client:"),a),e=(0,P.LZ)()}}else c="mock_no_credentials",console.warn("[\uD83D\uDCE4] [".concat(t,"] ⚠️ NO CREDENTIALS FOUND! Using mock client.")),e=(0,P.LZ)();console.info("[\uD83D\uDCE4] [".concat(t,"] STEP 3: Uploading file using ").concat(c," client")),console.info("[\uD83D\uDCE4] [".concat(t,"] Starting upload to bucket: ").concat(l,", file: ").concat(F));let d=Date.now(),{data:m,error:h}=await e.storage.from(l).upload(F,v,{cacheControl:"3600",upsert:!0}),b=Date.now()-d;if(h)throw console.error("[\uD83D\uDCE4] [".concat(t,"] ❌ UPLOAD FAILED after ").concat(b,"ms!"),{error:h,errorMessage:h.message,clientType:c}),h;console.info("[\uD83D\uDCE4] [".concat(t,"] ✓ Upload succeeded in ").concat(b,"ms"),{data:m,clientType:c}),console.info("[\uD83D\uDCE4] [".concat(t,"] STEP 4: Getting public URL for uploaded file"));let{data:f}=e.storage.from(l).getPublicUrl(F);if(console.info("[\uD83D\uDCE4] [".concat(t,"] \uD83D\uDD17 Generated URL:"),{publicUrl:f.publicUrl.substring(0,30)+"...",urlLength:f.publicUrl.length,isMockUrl:f.publicUrl.includes("example.com"),bucket:l,filePath:F,clientType:c}),f.publicUrl.includes("example.com")&&("real_from_api"===c||"real_from_config"===c)){console.warn("[\uD83D\uDCE4] [".concat(t,"] ⚠️ Received mock URL despite using real credentials!"),{url:f.publicUrl.substring(0,20)+"...",clientType:c});let e=(null==w?void 0:w.supabaseUrl)||p.v.supabase.url||"";if(e){let a=null===(g=e.match(/https:\/\/([^.]+)/))||void 0===g?void 0:g[1];a?(i="https://".concat(a,".supabase.co/storage/v1/object/public/").concat(l,"/").concat(F),console.info("[\uD83D\uDCE4] [".concat(t,"] \uD83D\uDD04 Created direct Supabase URL:"),{url:i.substring(0,30)+"...",urlLength:i.length,projectRef:a})):(i=f.publicUrl,console.warn("[\uD83D\uDCE4] [".concat(t,"] ⚠️ Couldn't extract project ref from URL: ").concat(e.substring(0,20),"...")))}else i=f.publicUrl,console.warn("[\uD83D\uDCE4] [".concat(t,"] ⚠️ No Supabase URL available to extract project ref"))}else i=f.publicUrl,f.publicUrl.includes("example.com")?c.startsWith("mock")&&console.info("[\uD83D\uDCE4] [".concat(t,"] ✓ Using expected mock URL with mock client:"),{url:i.substring(0,30)+"...",clientType:c}):console.info("[\uD83D\uDCE4] [".concat(t,"] ✅ UPLOAD SUCCESSFUL with real URL:"),{url:i.substring(0,30)+"...",length:i.length,clientType:c})}catch(a){console.error("[\uD83D\uDCE4] [".concat(t,"] ❌ ERROR IN UPLOAD PROCESS:"),{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?(null===(h=a.stack)||void 0===h?void 0:h.substring(0,150))+"...":"No stack trace"});let e={uploadId:t,hookId:j,timestamp:new Date().toISOString(),errorMessage:a instanceof Error?a.message:String(a),errorName:a instanceof Error?a.name:"Unknown",fileDetails:{type:v.type,size:v.size,name:v.name,path:F},credentialStatus:{hasCredentials:!!w,hasUrl:!!(null==w?void 0:w.supabaseUrl),hasKey:!!(null==w?void 0:w.supabaseKey),urlLength:(null==w?void 0:null===(f=w.supabaseUrl)||void 0===f?void 0:f.length)||0,keyLength:(null==w?void 0:null===(x=w.supabaseKey)||void 0===x?void 0:x.length)||0,traceId:(null==w?void 0:w.traceId)||"none",urlSource:(null==w?void 0:w.supabaseUrl)?"api_response":p.v.supabase.url?"config_fallback":"none"},browserInfo:{userAgent:navigator.userAgent,language:navigator.language,online:navigator.onLine},environment:"production"};console.error("[\uD83D\uDCE4] [".concat(t,"] \uD83D\uDCCA Comprehensive error details:"),e),d("Failed to upload file. Please try again."),console.error("[\uD83D\uDCE4] [".concat(t,"] \uD83D\uDEA8 CRITICAL: Upload failure in PRODUCTION!"),{recommendation:"Fix credentials on server"}),d("File upload failed. Please contact support with reference code: "+t),i=""}console.info("[\uD83D\uDCE4] [".concat(t,"] STEP 6: Updating form with file URL:"),{urlAvailable:!!i,urlLength:(null==i?void 0:i.length)||0,isMockUrl:null==i?void 0:i.includes("example.com")}),m("id_image_url",i,{shouldValidate:!0}),b("id_image_url"),console.info("[\uD83D\uDCE4] [".concat(t,"] ✓ Form updated with file URL")),c("success")}catch(e){console.error("[\uD83D\uDCE4] [".concat(t,"] \uD83D\uDCA5 Unhandled error in file upload:"),{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:"No stack trace"}),c("error"),d("Upload failed. Please try again.")}finally{console.info("[\uD83D\uDCE4] [".concat(t,"] ✓ File upload process complete with status: ").concat(i)),a(!1)}},[X,k,_,w,j,m,b,N,5242880,i]);(0,r.useEffect)(()=>{let e=X.current;return console.info("[\uD83D\uDCE4] [".concat(e,"] FileUpload component initialized, credential hook ID: ").concat(j)),()=>{console.info("[\uD83D\uDCE4] [".concat(e,"] FileUpload component cleanup"))}},[j]),(0,r.useEffect)(()=>{let e=x.current;if(!e)return;let t=t=>{t.preventDefault(),t.stopPropagation(),e.classList.add("border-blue-500")},a=t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("border-blue-500")},n=t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("border-blue-500"),t.dataTransfer&&S(t.dataTransfer.files)};return e.addEventListener("dragover",t),e.addEventListener("dragleave",a),e.addEventListener("drop",n),()=>{e.removeEventListener("dragover",t),e.removeEventListener("dragleave",a),e.removeEventListener("drop",n)}},[S]);let C=()=>{v.current&&v.current.click()};return(0,n.jsxs)("div",{id:"file-upload-section",className:"mb-6",children:[(0,n.jsxs)("h4",{className:"text-md font-medium mb-2",children:["Upload ID Document",D&&(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),"business"===y&&(0,n.jsx)("span",{className:"text-gray-500 ml-1",children:"(Optional)"})]}),(0,n.jsxs)("div",{className:"flex items-center mb-4 text-sm",children:[(0,n.jsx)("p",{className:"text-gray-700",children:"Please upload a clear photo of your government-issued ID"}),(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)("div",{className:"relative ml-2 group",children:(0,n.jsxs)("span",{className:"cursor-help text-blue-500",children:["ⓘ",(0,n.jsxs)("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 w-64 bg-gray-800 text-white text-xs rounded p-2 hidden group-hover:block z-10",children:["Accepted formats: JPG, PNG, HEIC",(0,n.jsx)("br",{}),"Maximum size: 5MB",(0,n.jsx)("br",{}),"Make sure all text is clearly readable",(0,n.jsx)("br",{}),(0,n.jsx)("strong",{children:D?"Required for merchant accounts":"Optional for Pro accounts"})]})]})})})]}),(0,n.jsx)("input",{ref:v,id:"hidden_file_input",type:"file",accept:"image/jpeg,image/png,image/jpg,image/heic",onChange:e=>{e.target.files&&S(e.target.files)},className:"hidden","aria-label":"Upload ID document"}),(0,n.jsx)("input",{type:"hidden",id:"id_image_url",...g("id_image_url")}),(0,n.jsx)("div",{ref:x,onClick:C,className:"border-2 border-dashed rounded-md p-6 text-center cursor-pointer transition-colors ".concat("error"===i?"border-red-500 bg-red-50":"success"===i?"border-green-500 bg-green-50":"border-gray-300 hover:border-blue-500"),children:s?(0,n.jsxs)("div",{className:"mx-auto",children:[(0,n.jsx)("img",{src:s,alt:"ID Preview",className:"max-h-40 mx-auto mb-2"}),"success"===i&&(0,n.jsxs)("div",{className:"flex items-center justify-center text-green-600 mb-2",children:[(0,n.jsx)("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,n.jsx)("span",{children:"Upload successful"})]}),(0,n.jsx)("p",{className:"text-sm text-blue-600",children:"Click to change file"})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,n.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4h-8m-12 0H8m12 0a4 4 0 01-4-4m4 4a4 4 0 004 4m0-4v-4m-4-4l4-4m0 0l4 4m-4-4v12",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:t?"Uploading...":"Drag and drop or click to upload ID"}),(0,n.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),C()},className:"mt-3 px-4 py-2 bg-blue-50 text-blue-600 border border-blue-200 rounded-md text-sm hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Select File"}),(0,n.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"JPG, PNG, HEIC • Max 5MB"})]})}),u&&(0,n.jsx)("p",{className:"form-error mt-2",children:u}),h.id_image_url&&(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 mt-3",children:(0,n.jsxs)("p",{className:"form-error font-medium flex items-center",children:[(0,n.jsx)("svg",{className:"w-5 h-5 mr-2 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(null===(e=h.id_image_url.message)||void 0===e?void 0:e.toString())||"ID document is required for merchant accounts"]})}),"success"===i&&!u&&(0,n.jsx)("p",{className:"text-xs mt-2 text-gray-500",children:"Your ID will be securely stored and only used for verification purposes."})]})}let T=e=>{var t,a,r,s,l;let{currentStep:i,setCurrentStep:c}=e,{register:u,formState:{errors:d},watch:m,setValue:p,trigger:g,setError:h,getValues:b}=(0,o.Gc)(),f=m("account_type"),x="business"===f,v="merchant"===f;if(4!==i)return null;let y=async()=>{if(x){c(5);return}let e=m("bank_name"),t=m("bank_branch"),a=m("bank_account_type"),n=m("account_currency"),r=m("bank_account_number");m("id_image_url");let o=!0;(!e||e.length<2)&&(p("bank_name",e||"",{shouldValidate:!0}),o=!1),(!t||t.length<2)&&(p("bank_branch",t||"",{shouldValidate:!0}),o=!1),(!a||a.length<2)&&(p("bank_account_type",a||"",{shouldValidate:!0}),o=!1),(!n||n.length<2)&&(p("account_currency",n||"",{shouldValidate:!0}),o=!1),(!r||r.length<4)&&(p("bank_account_number",r||"",{shouldValidate:!0}),o=!1);let s=b("id_image_url"),l="string"==typeof s&&s.startsWith("http");if(!l){var i;h("id_image_url",{type:"manual",message:"You must upload an ID document before proceeding"}),o=!1,null===(i=document.getElementById("file-upload-section"))||void 0===i||i.scrollIntoView({behavior:"smooth"})}await g(["bank_name","bank_branch","bank_account_type","account_currency","bank_account_number"]),o&&c(5)};return(0,n.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Banking Information"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:x?"Optionally provide your banking details. You can skip this step if you prefer.":"Please provide your banking details to receive payments as a Merchant Flashpoint."}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{htmlFor:"bank_name",className:"form-label",children:["Bank Name",v&&(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),x&&(0,n.jsx)("span",{className:"text-gray-500 ml-1",children:"(Optional)"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"})})}),(0,n.jsx)("input",{id:"bank_name",...u("bank_name"),className:"form-input input-with-icon",placeholder:"Enter your bank name","aria-required":"true","aria-invalid":d.bank_name?"true":"false"})]}),d.bank_name&&(0,n.jsx)("p",{className:"form-error",role:"alert",children:null===(t=d.bank_name.message)||void 0===t?void 0:t.toString()})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{htmlFor:"bank_branch",className:"form-label",children:["Bank Branch",v&&(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),x&&(0,n.jsx)("span",{className:"text-gray-500 ml-1",children:"(Optional)"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,n.jsxs)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,n.jsx)("input",{id:"bank_branch",...u("bank_branch"),className:"form-input input-with-icon",placeholder:"Enter your bank branch","aria-required":"true","aria-invalid":d.bank_branch?"true":"false"})]}),d.bank_branch&&(0,n.jsx)("p",{className:"form-error",role:"alert",children:null===(a=d.bank_branch.message)||void 0===a?void 0:a.toString()})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{htmlFor:"bank_account_type",className:"form-label",children:["Account Type",v&&(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),x&&(0,n.jsx)("span",{className:"text-gray-500 ml-1",children:"(Optional)"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),(0,n.jsxs)("select",{id:"bank_account_type",...u("bank_account_type"),className:"form-input input-with-icon appearance-none","aria-required":"true","aria-invalid":d.bank_account_type?"true":"false",children:[(0,n.jsx)("option",{value:"",children:"Select account type"}),(0,n.jsx)("option",{value:"checking",children:"Checking"}),(0,n.jsx)("option",{value:"savings",children:"Savings"})]}),(0,n.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),d.bank_account_type&&(0,n.jsx)("p",{className:"form-error",role:"alert",children:null===(r=d.bank_account_type.message)||void 0===r?void 0:r.toString()})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{htmlFor:"account_currency",className:"form-label",children:["Currency",v&&(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),x&&(0,n.jsx)("span",{className:"text-gray-500 ml-1",children:"(Optional)"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,n.jsxs)("select",{id:"account_currency",...u("account_currency"),className:"form-input input-with-icon appearance-none","aria-required":"true","aria-invalid":d.account_currency?"true":"false",children:[(0,n.jsx)("option",{value:"",children:"Select currency"}),(0,n.jsx)("option",{value:"USD",children:"USD - US Dollar"}),(0,n.jsx)("option",{value:"EUR",children:"EUR - Euro"}),(0,n.jsx)("option",{value:"JMD",children:"JMD - Jamaican Dollar"}),(0,n.jsx)("option",{value:"KYD",children:"KYD - Cayman Islands Dollar"}),(0,n.jsx)("option",{value:"ANG",children:"ANG - Netherlands Antillean Guilder"}),(0,n.jsx)("option",{value:"XCG",children:"XCG - Caribbean Guilder"})]}),(0,n.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),d.account_currency&&(0,n.jsx)("p",{className:"form-error",role:"alert",children:null===(s=d.account_currency.message)||void 0===s?void 0:s.toString()})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsxs)("label",{htmlFor:"bank_account_number",className:"form-label",children:["Account Number",v&&(0,n.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),x&&(0,n.jsx)("span",{className:"text-gray-500 ml-1",children:"(Optional)"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),(0,n.jsx)("input",{id:"bank_account_number",...u("bank_account_number"),className:"form-input input-with-icon",placeholder:"Enter your account number","aria-required":"true","aria-invalid":d.bank_account_number?"true":"false",type:"text"})]}),d.bank_account_number&&(0,n.jsx)("p",{className:"form-error",role:"alert",children:null===(l=d.bank_account_number.message)||void 0===l?void 0:l.toString()}),(0,n.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Enter your complete account number without spaces or special characters"})]}),(0,n.jsx)(z,{}),(0,n.jsxs)("div",{className:"mt-8 flex justify-between",children:[(0,n.jsxs)("button",{type:"button",onClick:()=>c(3),className:"form-btn-secondary flex items-center","aria-label":"Go back to previous step",children:[(0,n.jsx)("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),(0,n.jsx)("span",{children:"Back"})]}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[x&&(0,n.jsxs)("button",{type:"button",onClick:()=>{p("bank_name",""),p("bank_branch",""),p("bank_account_type",""),p("account_currency",""),p("bank_account_number",""),p("id_image_url",""),c(5)},className:"form-btn-secondary flex items-center","aria-label":"Skip banking information",children:[(0,n.jsx)("span",{children:"Skip"}),(0,n.jsx)("svg",{className:"ml-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),(0,n.jsxs)("button",{type:"button",onClick:y,className:"form-btn flex items-center","aria-label":"Continue to next step",children:[(0,n.jsx)("span",{children:"Continue"}),(0,n.jsx)("svg",{className:"ml-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]})]})};var B=a(6691),V=a.n(B),O=a(9809);function R(){let[e,t]=(0,r.useState)(null),[o,s]=(0,r.useState)(null),[l,i]=(0,r.useState)(!1),c=window.ENV&&window.ENV.BUILD_TIME||window.location.hostname.includes("digitalocean")&&!window.navigator.serviceWorker||null!==document.querySelector('meta[name="static-build"]'),u=async()=>{i(!0),s(null),t(null);let e={name:"Test User",phone:"+12345678900",email:"test@example.com",account_type:"personal",terms_accepted:!0,business_name:"",business_address:"",latitude:null,longitude:null,bank_name:"",bank_branch:"",bank_account_type:"",account_currency:"",bank_account_number:"",id_image_url:""};try{if(console.log("Submitting test data"),console.log("Is static build:",c),c){console.log("Using direct Supabase connection for static build");let{supabase:s}=await Promise.resolve().then(a.bind(a,274));console.log("Testing Supabase connection"),console.log("Attempting to insert directly into signups table...");try{var n,r,o,l;let a={name:e.name,phone:e.phone,email:e.email||null,account_type:e.account_type,terms_accepted:e.terms_accepted,...e.business_name?{business_name:e.business_name}:{},...e.business_address?{business_address:e.business_address}:{},...null!==e.latitude&&void 0!==e.latitude?{latitude:e.latitude}:{},...null!==e.longitude&&void 0!==e.longitude?{longitude:e.longitude}:{},...e.bank_name?{bank_name:e.bank_name}:{},...e.bank_branch?{bank_branch:e.bank_branch}:{},...e.bank_account_type?{bank_account_type:e.bank_account_type}:{},...e.account_currency?{account_currency:e.account_currency}:{},...e.bank_account_number?{bank_account_number:e.bank_account_number}:{},...e.id_image_url?{id_image_url:e.id_image_url}:{},client_version:(null===(n=window.ENV)||void 0===n?void 0:n.VERSION)||"test-component",submission_source:"test_static_client",submitted_at:new Date,timestamp:new Date().toISOString(),attempt:"test_component",user_agent:navigator.userAgent,device_info:JSON.stringify({platform:navigator.platform,language:navigator.language,vendor:navigator.vendor,screenSize:"".concat(window.screen.width,"x").concat(window.screen.height)})};console.log("Inserting schema-validated data:",a);let{data:c,error:u}=await s.from("signups").insert([a]).select();if(u){if(console.error("Error inserting into signups table:",u),"PGRST204"===u.code&&u.message&&u.message.includes("column")||(null===(r=u.message)||void 0===r?void 0:r.includes("does not exist"))){console.log("Column error detected. Trying with minimal fields only.");let a={name:e.name,phone:e.phone,account_type:"personal",terms_accepted:!0,client_version:"minimal-fallback",submission_source:"test_fallback",timestamp:new Date().toISOString(),attempt:"minimal_fallback"};console.log("Retrying with minimal data:",a);let{data:n,error:r}=await s.from("signups").insert([a]).select();if(r)throw console.error("Retry with minimal data also failed:",r),Error("Could not insert into signups table: ".concat(r.message));console.log("Successfully inserted minimal data into signups table:",n),t({success:!0,message:"Form submitted successfully with minimal data",data:n[0]}),i(!1);return}if((null===(o=u.message)||void 0===o?void 0:o.includes("row-level security"))||(null===(l=u.message)||void 0===l?void 0:l.includes("permission denied")))throw console.error("Row-level security policy error. This is likely a permissions issue."),Error("RLS policy error: ".concat(u.message));throw Error("Error inserting into signups table: ".concat(u.message))}console.log("Successfully inserted data into signups table:",c),t({success:!0,message:"Form submitted successfully via direct Supabase connection",data:c[0]}),i(!1);return}catch(a){console.error("Failed to insert into signups table:",a),console.log("Trying storage fallback...");try{let a=JSON.stringify({...e,submitted_at:new Date().toISOString(),submission_source:"test_static_client"}),n=new Blob([a],{type:"application/json"}),r="form_submission_".concat(Date.now(),".json");for(let e of["formdata","public","id-uploads","forms"])try{if(console.log("Trying to upload to ".concat(e," bucket...")),"formdata"!==e)try{console.log("Creating temporary auth session for storage access...");let{data:e,error:t}=await s.auth.signUp({email:"temp_".concat(Date.now(),"@example.com"),password:"temp_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2))});t?console.warn("Auth attempt failed, trying anonymous upload anyway:",t):console.log("Temporary auth session created successfully")}catch(e){console.warn("Auth attempt exception, trying anonymous upload anyway:",e)}let{data:a,error:o}=await s.storage.from(e).upload(r,n,{cacheControl:"3600",upsert:!0});if(o)console.error("Error uploading to ".concat(e,":"),o);else{console.log("Successfully uploaded to ".concat(e," bucket:"),a),t({success:!0,message:"Form data stored as file in ".concat(e," bucket"),data:{path:a.path,bucket:e,created_at:new Date().toISOString()}}),i(!1);return}}catch(t){console.error("Error with ".concat(e," bucket:"),t)}throw Error("All storage fallback attempts failed")}catch(e){throw console.error("Storage fallback failed:",e),Error("Could not submit form data: ".concat(e.message))}}}else{console.log("Using API endpoint for regular build");let a=window.location.origin,n="".concat(a,"/api/submit");console.log("Fetch URL:",n),console.log("Request data:",JSON.stringify(e,null,2));let r=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify(e),credentials:"include"});console.log("Response status:",r.status);let o=await r.json();console.log("Response data:",o),t(o)}}catch(e){console.error("Test submit error:",e),s(e.message||"An error occurred")}finally{i(!1)}};return(0,n.jsxs)("div",{className:"p-4 mt-8 border border-gray-200 rounded-lg",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"API Test"}),c&&(0,n.jsx)("div",{className:"mb-2 px-3 py-1 bg-blue-50 text-blue-700 text-xs rounded-lg inline-block",children:"Static Build Mode: Using Direct Supabase Connection"}),(0,n.jsx)("button",{onClick:u,disabled:l,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:l?"Testing...":c?"Test Direct Connection":"Test API Submit"}),o&&(0,n.jsxs)("div",{className:"mt-4 p-3 bg-red-100 border border-red-200 rounded text-red-700",children:[(0,n.jsx)("p",{className:"font-semibold",children:"Error:"}),(0,n.jsx)("p",{children:o})]}),e&&(0,n.jsxs)("div",{className:"mt-4 p-3 bg-green-100 border border-green-200 rounded text-green-700",children:[(0,n.jsx)("p",{className:"font-semibold",children:"Response:"}),(0,n.jsx)("pre",{className:"mt-2 whitespace-pre-wrap text-sm",children:JSON.stringify(e,null,2)})]})]})}var G=a(8662);function q(e){let{onAuthenticated:t}=e,[a,o]=(0,r.useState)(""),[s,l]=(0,r.useState)(""),[i,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(null),[m,p]=(0,r.useState)(!1),[h,b]=(0,r.useState)(null),f=async e=>{e.preventDefault(),d(null),b(null),p(!0);try{if(!a||!s){d("Email and password are required"),p(!1);return}if(s.length<8){d("Password must be at least 8 characters"),p(!1);return}let e=i?await G.authService.signUp(a,s):await G.authService.signIn(a,s);if(!e.success){d(e.error||"Authentication failed"),p(!1);return}if(b(e.message||"Authentication successful"),i&&!e.token){p(!1);return}t()}catch(e){g.k.error("Authentication error",e),d("An unexpected error occurred. Please try again.")}finally{p(!1)}};return(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:i?"Create an Account":"Sign In"}),h&&(0,n.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded mb-4",children:h}),u&&(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:u}),(0,n.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,n.jsx)("input",{id:"email",type:"email",value:a,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,n.jsx)("input",{id:"password",type:"password",value:s,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,minLength:8}),(0,n.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:i?"Must be at least 8 characters":""})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{type:"submit",disabled:m,className:"w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat(m?"opacity-70 cursor-not-allowed":""),children:m?"Please wait...":i?"Create Account":"Sign In"})})]}),(0,n.jsx)("div",{className:"mt-4 text-center",children:(0,n.jsx)("button",{type:"button",onClick:()=>c(!i),className:"text-sm text-blue-600 hover:text-blue-800",children:i?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})}let W=()=>{let e=Math.floor(10*Math.random())+1,t=Math.floor(10*Math.random())+1;return{num1:e,num2:t,answer:e+t}};function K(e){let{onAuthenticated:t}=e,[a]=(0,r.useState)(W()),[o,s]=(0,r.useState)(""),[l,i]=(0,r.useState)(null),[c,u]=(0,r.useState)(!1),[d,m]=(0,r.useState)(!1);return(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Quick Verification"}),l&&(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:l}),d&&(0,n.jsxs)("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded mb-4 flex items-center",children:[(0,n.jsx)("svg",{className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Verification successful! You can proceed with your submission."]}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u(!0),i(null);let n=parseInt(o,10);if(isNaN(n)){i("Please enter a valid number"),u(!1);return}if(n!==a.answer){i("Incorrect answer, please try again"),u(!1);return}try{let e="guest_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,10));localStorage.setItem("authenticatedUser",JSON.stringify({userId:e,authenticated:!0,expires:Date.now()+864e5,method:"captcha"})),m(!0),t(e),g.k.info("Captcha authentication successful",{userId:e})}catch(e){i("Authentication failed. Please try again."),g.k.error("Captcha authentication error",e)}finally{u(!1)}},className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"captcha",className:"block text-sm font-medium text-gray-700 mb-1",children:"Please solve this simple math problem to continue:"}),(0,n.jsx)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200 mb-3 text-center",children:(0,n.jsxs)("span",{className:"text-lg font-medium",children:[a.num1," + ",a.num2," = ?"]})}),(0,n.jsx)("input",{id:"captcha",type:"number",value:o,onChange:e=>s(e.target.value),disabled:c||d,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Your answer",required:!0})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{type:"submit",disabled:c||!o||d,className:"w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat(c||!o||d?"opacity-70 cursor-not-allowed":""),children:c?"Verifying...":d?"Verified ✓":"Verify & Continue"})})]}),(0,n.jsx)("div",{className:"mt-4 text-center",children:(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"This helps us prevent automated submissions. By continuing, you agree to our Terms of Service and Privacy Policy."})})]})}function J(e){let{onAuthenticated:t}=e,[a,o]=(0,r.useState)("captcha");return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[(0,n.jsxs)("div",{className:"flex border-b border-gray-200",children:[(0,n.jsx)("button",{onClick:()=>o("captcha"),className:"flex-1 py-3 text-center font-medium transition-all duration-200 ".concat("captcha"===a?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),"data-selected":"captcha"===a,"aria-controls":"captcha-auth-panel",id:"captcha-auth-tab",children:(0,n.jsxs)("div",{className:"flex items-center justify-center",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-9.618 5.04 11.946 11.946 0 019.618 5.04 11.955 11.955 0 019.618-5.04"})}),"Quick Verify"]})}),(0,n.jsx)("button",{onClick:()=>o("email"),className:"flex-1 py-3 text-center font-medium transition-all duration-200 ".concat("email"===a?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),"data-selected":"email"===a,"aria-controls":"email-auth-panel",id:"email-auth-tab",children:(0,n.jsxs)("div",{className:"flex items-center justify-center",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Email"]})})]}),(0,n.jsxs)("div",{className:"p-4 overflow-hidden",children:[(0,n.jsx)("div",{className:"transition-all duration-300 transform",style:{opacity:"email"===a?1:0,height:"email"===a?"auto":0,position:"email"===a?"relative":"absolute"},children:"email"===a&&(0,n.jsx)("div",{id:"email-auth-panel",role:"tabpanel","aria-labelledby":"email-auth-tab",children:(0,n.jsx)(q,{onAuthenticated:()=>{t()}})})}),(0,n.jsx)("div",{className:"transition-all duration-300 transform",style:{opacity:"captcha"===a?1:0,height:"captcha"===a?"auto":0,position:"captcha"===a?"relative":"absolute"},children:"captcha"===a&&(0,n.jsx)("div",{id:"captcha-auth-panel",role:"tabpanel","aria-labelledby":"captcha-auth-tab",children:(0,n.jsx)(K,{onAuthenticated:e=>{t(e)}})})})]}),(0,n.jsx)("div",{className:"text-center pb-4 px-4",children:(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Quick verification is the fastest way to continue.","captcha"===a?" Have an account? Switch to email authentication.":" New user? Switch to quick verification."]})})]})}function Y(){var e,t,l;let[i,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(1),[,p]=(0,r.useState)(!1),[h,b]=(0,r.useState)(!1),x=(0,o.cI)({resolver:(0,s.F)(m),defaultValues:{account_type:"personal",terms_accepted:!1,wants_terminal:!1}}),{handleSubmit:v}=x,y=async e=>{console.log("Form onSubmit called with data:",e),console.log("\uD83D\uDCCD SUBMIT COORDINATES:",{latitude:e.latitude,longitude:e.longitude,latitudeType:typeof e.latitude,longitudeType:typeof e.longitude}),console.log("\uD83D\uDCBB TERMINAL CHECKBOX VALUE IN SUBMIT:",{wantsTerminal:e.wants_terminal,type:typeof e.wants_terminal,isTruthy:!!e.wants_terminal}),void 0!==e.wants_terminal&&(e.wants_terminal=!!e.wants_terminal,console.log("\uD83D\uDCBB TERMINAL VALUE FORCED TO BOOLEAN:",{wantsTerminal:e.wants_terminal,type:typeof e.wants_terminal}));try{var t;p(!0),console.log("Setting submitting state to true");let{getValues:n}=x,r=n();console.log("Form values from getValues:",r),console.log("\uD83D\uDCCD GETVALUES COORDINATES:",{latitude:r.latitude,longitude:r.longitude,latitudeType:typeof r.latitude,longitudeType:typeof r.longitude});let o=!0;if(!r.name||r.name.length<2){x.setError("name",{message:"Name is required"}),d(1),o=!1;return}if(!r.phone){x.setError("phone",{message:"Phone number is required"}),d(1),o=!1;return}try{a.e(858).then(a.bind(a,9858)).then(e=>{let{parsePhoneNumberFromString:t}=e,a=t(r.phone);a&&a.isValid()||(x.setError("phone",{message:"Valid phone number with country code is required"}),d(1),o=!1)}).catch(()=>{/^\+?[0-9]{10,15}$/.test(r.phone)||(x.setError("phone",{message:"Valid phone number with country code is required"}),d(1),o=!1)})}catch(e){if(!/^\+?[0-9]{10,15}$/.test(r.phone)){x.setError("phone",{message:"Valid phone number with country code is required"}),d(1),o=!1;return}}if("business"===r.account_type){if(!r.business_name||r.business_name.length<2){x.setError("business_name",{message:"Professional practice name is required"}),d(3),o=!1;return}if(!r.business_address||r.business_address.length<5){x.setError("business_address",{message:"Professional address is required"}),d(3),o=!1;return}}if("merchant"===r.account_type){if(!r.bank_name){x.setError("bank_name",{message:"Bank name is required"}),d(4),o=!1;return}if(!r.bank_branch){x.setError("bank_branch",{message:"Bank branch is required"}),d(4),o=!1;return}if(!r.bank_account_type){x.setError("bank_account_type",{message:"Account type is required"}),d(4),o=!1;return}if(!r.account_currency){x.setError("account_currency",{message:"Currency is required"}),d(4),o=!1;return}if(!r.bank_account_number){x.setError("bank_account_number",{message:"Account number is required"}),d(4),o=!1;return}let e=r.id_image_url,t="string"==typeof e&&e.startsWith("http");if(!t){x.setError("id_image_url",{message:"ID image is required for merchant accounts"}),d(4),o=!1;return}}if(!r.terms_accepted){x.setError("terms_accepted",{message:"You must accept the terms and conditions"}),d(5),o=!1;return}if(!o)return;let s={accountType:e.account_type,businessName:e.business_name,hasAcceptedTerms:e.terms_accepted};g.k.info("Submitting merchant registration form",s),console.log("Form data being submitted:",e);let l=await f.submitSignupForm(e);if(console.log("API response:",l),!l.success){g.k.error("Form submission failed",l.error);let e="string"==typeof l.error?l.error:JSON.stringify(l.error);throw Error(e)}g.k.info("Form submission successful",{timestamp:null===(t=l.data)||void 0===t?void 0:t.created_at,accountType:e.account_type}),b(!0)}catch(e){g.k.error("Error submitting form",e),alert("There was an error submitting your information. Please try again.")}finally{p(!1)}};return((0,r.useEffect)(()=>{let e=async()=>{let e="undefined"!=typeof navigator&&navigator.userAgent.includes("Playwright");if(e){console.log("TEST MODE: Bypassing authentication"),G.authService.currentUser={id:"test-user-id",email:"test@example.com",role:"authenticated",aud:"authenticated"},c(!0);return}let t=await G.authService.isAuthenticated();c(t)};e()},[]),h)?(0,n.jsxs)("div",{className:"text-center py-10 max-w-md mx-auto",children:[(0,n.jsx)("div",{className:"bg-blue-50 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-8",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,n.jsx)("h2",{className:"text-3xl font-bold mb-4 text-gray-800",children:"Application Successful!"}),(0,n.jsx)("div",{className:"bg-blue-50 p-6 rounded-xl mb-8",children:(0,n.jsx)("p",{className:"text-gray-700",children:"Congratulations! Your Flash merchant account application has been received. Download the Flash app to set up your account and explore our point-of-sale system."})}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("a",{href:"https://getflash.io/app",className:"inline-block w-full px-8 py-4 bg-green-500 text-white rounded-lg font-medium hover:bg-green-600 transition-colors shadow-lg transform hover:-translate-y-1 hover:shadow-xl",target:"_blank",rel:"noopener noreferrer","aria-label":"Download Flash App",children:(0,n.jsxs)("div",{className:"flex items-center justify-center",children:[(0,n.jsx)("div",{className:"mr-4 relative w-8 h-8",children:(0,n.jsx)(V(),{src:O.default,alt:"Flash Logo",width:32,height:32,style:{width:"auto",height:"auto"},className:"object-contain"})}),(0,n.jsxs)("div",{className:"text-left",children:[(0,n.jsx)("p",{className:"text-xl font-bold leading-tight",children:"Get the Flash App"}),(0,n.jsx)("p",{className:"text-sm opacity-90",children:"App Store • Google Play • Direct Download"})]})]})}),(0,n.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"On our download page, you'll find:"}),(0,n.jsxs)("ul",{className:"text-xs text-gray-600 text-left list-disc pl-5 space-y-1",children:[(0,n.jsx)("li",{children:"App Store and Google Play links"}),(0,n.jsx)("li",{children:"TestFlight beta version access"}),(0,n.jsx)("li",{children:"Direct APK download from GitHub"}),(0,n.jsx)("li",{children:"Virtual demo of our point-of-sale system"}),(0,n.jsx)("li",{children:"Tap-to-pay card system demonstration"})]})]}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Need help? Contact our support at"," ",(0,n.jsx)("a",{href:"mailto:support@flash.com",className:"text-blue-600 hover:underline",children:"support@flash.com"})]})]})]}):i?(0,n.jsx)(o.RV,{...x,children:(0,n.jsxs)("form",{onSubmit:v(y),className:"space-y-6",children:[(0,n.jsxs)("div",{className:"mb-10",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6 relative",children:[(0,n.jsx)("div",{className:"absolute top-1/2 left-0 right-0 h-1 bg-gray-200 -translate-y-1/2 z-0"}),(0,n.jsx)("div",{className:"absolute h-1 bg-blue-600 top-1/2 -translate-y-1/2 left-0 z-0 transition-all duration-500 ease-in-out",style:{width:"".concat(Math.min(100,(u-1)/4*100),"%")}}),[1,2,3,4,5].map(e=>{let t=u===e,a=u>e;return(0,n.jsx)("div",{className:"flex flex-col items-center z-10 relative",children:(0,n.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 ".concat(t?"bg-blue-600 text-white ring-4 ring-blue-100":a?"bg-green-500 text-white":"bg-white text-gray-400 border-2 border-gray-200"),"aria-current":t?"step":void 0,"aria-label":"Step ".concat(e," ").concat(a?"completed":t?"current":"pending"),children:a?(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):(0,n.jsx)("span",{className:"text-sm font-medium",children:e})})},e)})]}),(0,n.jsxs)("div",{className:"text-sm font-medium text-center text-gray-700 mb-4",children:[1===u&&"Personal Information",2===u&&"Account Type",3===u&&"Business Information",4===u&&"Merchant Information",5===u&&"Terms & Conditions"]}),(0,n.jsx)("div",{className:"w-full bg-gray-100 h-1.5 rounded-full overflow-hidden",children:(0,n.jsx)("div",{className:"bg-blue-600 h-full rounded-full transition-all duration-300 ease-in-out",style:{width:"".concat((u-1)/4*100,"%")},role:"progressbar","aria-valuenow":(u-1)/4*100,"aria-valuemin":0,"aria-valuemax":100})}),(0,n.jsx)("div",{className:"mt-2 text-right",children:(0,n.jsxs)("span",{className:"text-xs text-gray-500",children:[(null===(e=G.authService.currentUser)||void 0===e?void 0:e.email)?"Email: "+G.authService.currentUser.email:(null===(t=G.authService.currentUser)||void 0===t?void 0:t.phone)?"".concat(G.authService.currentUser.phone.substring(0,3),"***").concat(G.authService.currentUser.phone.slice(-2)):"Anonymous",(0,n.jsx)("button",{type:"button",onClick:()=>{var e;(null===(e=G.authService.currentUser)||void 0===e?void 0:e.email)?G.authService.signOut().then(()=>c(!1)):(localStorage.removeItem("authenticatedUser"),G.authService.currentUser=null,c(!1))},className:"ml-2 text-blue-600 hover:underline",children:"Exit"})]})})]}),(0,n.jsx)(_,{currentStep:u,setCurrentStep:d}),(0,n.jsx)(j,{currentStep:u,setCurrentStep:d}),(0,n.jsx)(U,{currentStep:u,setCurrentStep:d}),4===u&&(0,n.jsx)(T,{currentStep:u,setCurrentStep:d}),(0,n.jsx)(X,{currentStep:u,setCurrentStep:d}),(null===(l=G.authService.currentUser)||void 0===l?void 0:l.email)==="admin@bobodread.com"&&(0,n.jsx)(R,{})]})}):(0,n.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,n.jsx)(J,{onAuthenticated:(e,t)=>{e&&t&&(G.authService.currentUser={id:e,phone:t,email:null,role:"authenticated",aud:"authenticated"}),c(!0)}}),(0,n.jsx)("div",{className:"mt-8 text-center text-sm text-gray-500",children:(0,n.jsxs)("p",{children:["By signing in, you agree to our"," ",(0,n.jsx)("a",{href:"https://getflash.io/legal/terms.html",className:"text-blue-600 hover:underline",children:"Terms of Service"})," ","and"," ",(0,n.jsx)("a",{href:"https://getflash.io/legal/privacy.html",className:"text-blue-600 hover:underline",children:"Privacy Policy"})]})})]})}var H=()=>{var e,t,a;console.group("\uD83D\uDD0D Environment Debug"),console.log("Runtime Environment:",{nodeEnv:"production",isBuildTime:"true",isStaticBuild:window.ENV&&window.ENV.BUILD_TIME}),window.ENV?console.log("window.ENV is available:",{keys:Object.keys(window.ENV),hasBuildTime:!!window.ENV.BUILD_TIME,buildDate:window.ENV.BUILD_DATE,hasSupabaseUrl:!!window.ENV.SUPABASE_URL,hasSupabaseKey:!!window.ENV.SUPABASE_KEY}):console.warn("window.ENV is NOT available");let n=!!document.querySelector('script[src="/env-config.js"]');console.log("env-config.js script:",n?"Found in DOM":"Not found in DOM");let r=document.querySelector('meta[name="supabase-url"]'),o=document.querySelector('meta[name="supabase-anon-key"]');return console.log("Supabase Meta Tags:",{urlMeta:r?"Found":"Not found",keyMeta:o?"Found":"Not found"}),console.log("Next.js Runtime:",{nextData:!!document.getElementById("__NEXT_DATA__"),nextBuildId:(null===(e=window.__NEXT_DATA__)||void 0===e?void 0:e.buildId)||"Not available"}),console.groupEnd(),{env:window.ENV||{},hasCredentials:!!((null===(t=window.ENV)||void 0===t?void 0:t.SUPABASE_URL)&&(null===(a=window.ENV)||void 0===a?void 0:a.SUPABASE_KEY)),hasEnvConfigScript:n,hasMeta:!!(r&&o)}},Z=(a(2601),()=>{let[e,t]=(0,r.useState)(!1),[a,n]=(0,r.useState)({});return(0,r.useEffect)(()=>{},[!1]),null});function Q(){let[e,t]=(0,r.useState)(!0),[a,o]=(0,r.useState)(null);return((0,r.useEffect)(()=>{try{console.log("Form page mounted");let e=H();console.log("Environment debug results:",e);let a=window.ENV&&window.ENV.BUILD_TIME;console.log("Is static build:",a),a&&(console.log("Initializing static build environment"),window.ENV=window.ENV||{}),t(!1)}catch(e){console.error("Error initializing form page:",e),o(e instanceof Error?e.message:"Unknown error"),t(!1)}},[]),e)?(0,n.jsx)("div",{className:"max-w-xl mx-auto bg-white p-8 rounded-xl shadow-md",children:(0,n.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}),(0,n.jsx)("span",{className:"ml-3",children:"Loading form..."})]})}):a?(0,n.jsx)("div",{className:"max-w-xl mx-auto bg-white p-8 rounded-xl shadow-md",children:(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsxs)("div",{className:"bg-red-100 border border-red-300 text-red-700 px-4 py-3 rounded",children:[(0,n.jsx)("p",{className:"font-bold",children:"Error loading form"}),(0,n.jsx)("p",{children:a})]}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]})}):(0,n.jsxs)("div",{className:"max-w-xl mx-auto bg-white p-8 rounded-xl shadow-md",children:[(0,n.jsx)(Y,{}),(0,n.jsx)(Z,{})]})}},8662:function(e,t,a){"use strict";a.d(t,{authService:function(){return p}});var n=a(4756),r=a(5477),o=a(7729),s=a(2601);let l="https://uygbqnrqwjvzdfbqeipf.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5Z2JxbnJxd2p2emRmYnFlaXBmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMTA5NzQsImV4cCI6MjA2MDU4Njk3NH0._galk7m0xPn_HUctiSbPw5fdWU7jyI5La-Xtm6zAt9g",c=l&&i&&!0,u=s.env.NEXT_PUBLIC_SITE_URL||s.env.NEXT_PUBLIC_VERCEL_URL||r.v.supabase.siteUrl,d=c?(0,n.eI)(l,i,{auth:{persistSession:!0,autoRefreshToken:!0,...u?{redirectTo:u}:{}}}):(o.k.warn("Using mock Supabase client (missing credentials)",{hasUrl:!0,hasKey:!0,nodeEnv:"production",isBuildTime:"true"}),{from:e=>({insert:t=>(o.k.info("Mock insert into ".concat(e," table"),{mock:!0}),Promise.resolve({data:[{id:"mock-id"}],error:null})),select:(t,a)=>(o.k.info("Mock select from ".concat(e," table"),{mock:!0,columns:t}),Promise.resolve({data:[{id:"mock-id",created_at:new Date().toISOString()}],error:null}))}),storage:{listBuckets:()=>(o.k.info("Mock list Supabase storage buckets",{mock:!0}),Promise.resolve({data:[{name:"id_uploads",public:!0}],error:null})),createBucket:(e,t)=>(o.k.info("Mock create bucket: ".concat(e),{mock:!0,options:t}),Promise.resolve({data:{name:e},error:null})),from:e=>({upload:(t,a,n)=>(o.k.info("Mock file upload to ".concat(e,"/").concat(t),{mock:!0,options:n}),Promise.resolve({data:{path:t},error:null})),getPublicUrl:t=>(o.k.info("Mock get public URL for ".concat(e,"/").concat(t),{mock:!0}),{data:{publicUrl:"https://example.com/".concat(e,"/").concat(t)}}),list:t=>(o.k.info("Mock list files in ".concat(e).concat(t?"/"+t:""),{mock:!0}),Promise.resolve({data:[{name:"example.jpg",id:"mock-file-id"}],error:null})),remove:t=>{let a="string"==typeof t?[t]:t;return o.k.info("Mock remove files from ".concat(e),{mock:!0,paths:a}),Promise.resolve({data:{paths:a},error:null})},createSignedUrl:(t,a)=>(o.k.info("Mock create signed URL for ".concat(e,"/").concat(t),{mock:!0,expiresIn:a}),Promise.resolve({data:{signedUrl:"https://example.com/signed/".concat(e,"/").concat(t,"?expires=").concat(Date.now()+a)},error:null}))})},auth:{signUp:()=>Promise.resolve({data:{user:null,session:null},error:null}),signIn:()=>Promise.resolve({data:{user:null,session:null},error:null}),signInWithPassword:()=>Promise.resolve({data:{user:null,session:null},error:null}),signOut:()=>Promise.resolve({error:null}),getSession:()=>Promise.resolve({data:{session:null},error:null})}});c&&o.k.info("Supabase client initialized with real credentials",{url:l.substring(0,8)+"..."});var m=a(5667);let p={currentUser:null,async getCurrentUser(){try{try{let e=localStorage.getItem("authenticatedUser");if(e){let t=JSON.parse(e);if(t.expires>Date.now()&&t.authenticated)return this.currentUser={id:t.userId,phone:t.phoneNumber,email:null,role:"authenticated",aud:"authenticated"},this.currentUser}}catch(e){}try{var e;let{data:t}=await d.auth.getSession();if(null==t?void 0:null===(e=t.session)||void 0===e?void 0:e.user)return this.currentUser=t.session.user,t.session.user}catch(t){let e=t instanceof Error?t:Error("Unknown error");o.k.warn("Error getting Supabase session",e)}return null}catch(e){return o.k.error("Error getting current user",e),null}},async signIn(e,t){try{var a,n,s,l;o.k.info("Attempting sign in",{email:e.substring(0,3)+"..."});let{data:i,error:c}=await d.auth.signInWithPassword({email:e,password:t});if(c){o.k.error("Supabase sign in error",c);try{let o=await m.b.getToken(),l=await fetch("".concat(r.v.api.baseUrl||"","/api/auth"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t,csrf_token:o})}),i=await l.json();if(!i.success)return{success:!1,error:i.error||"Authentication failed"};return this.currentUser=null===(a=i.data)||void 0===a?void 0:a.user,{success:!0,message:"Sign in successful",user:null===(n=i.data)||void 0===n?void 0:n.user,token:null===(s=i.data)||void 0===s?void 0:s.token}}catch(e){return o.k.error("API sign in error",e),{success:!1,error:"Authentication failed. Please try again later."}}}if(i.user)return this.currentUser=i.user,{success:!0,message:"Sign in successful",user:{id:i.user.id,email:i.user.email||""},token:null===(l=i.session)||void 0===l?void 0:l.access_token};return{success:!1,error:"Authentication failed: User not found"}}catch(e){return o.k.error("Sign in error",e),{success:!1,error:"Authentication failed. Please try again later."}}},async signUp(e,t){try{var a,n,s,l,i;o.k.info("Attempting registration",{email:e.substring(0,3)+"..."});let{data:c,error:u}=await d.auth.signUp({email:e,password:t});if(u){o.k.error("Supabase sign up error",u);try{let o=await m.b.getToken(),i=await fetch("".concat(r.v.api.baseUrl||"","/api/auth"),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t,csrf_token:o})}),c=await i.json();if(!c.success)return{success:!1,error:c.error||"Registration failed"};return(null===(a=c.data)||void 0===a?void 0:a.user)&&(this.currentUser=c.data.user),{success:!0,message:(null===(n=c.data)||void 0===n?void 0:n.emailConfirmationRequired)?"Registration successful. Please check your email to confirm your account.":"Registration successful",user:null===(s=c.data)||void 0===s?void 0:s.user,token:null===(l=c.data)||void 0===l?void 0:l.token}}catch(e){return o.k.error("API sign up error",e),{success:!1,error:"Registration failed. Please try again later."}}}if(c.user){this.currentUser=c.user;let e=!c.session;return{success:!0,message:e?"Registration successful. Please check your email to confirm your account.":"Registration successful",user:{id:c.user.id,email:c.user.email||""},token:null===(i=c.session)||void 0===i?void 0:i.access_token}}return{success:!1,error:"Registration failed: User not created"}}catch(e){return o.k.error("Sign up error",e),{success:!1,error:"Registration failed. Please try again later."}}},async signOut(){try{let{error:e}=await d.auth.signOut();if(e)return o.k.error("Sign out error",e),!1;return this.currentUser=null,!0}catch(e){return o.k.error("Sign out error",e),!1}},async getAuthToken(){try{var e;let{data:t}=await d.auth.getSession();if(null===(e=t.session)||void 0===e?void 0:e.access_token)return t.session.access_token}catch(e){o.k.error("Error getting Supabase auth token",e)}try{let e=localStorage.getItem("authenticatedUser");if(e){let t=JSON.parse(e);if(t.expires>Date.now()&&t.authenticated)return"PhoneAuth ".concat(t.userId,":").concat(t.phoneNumber,":").concat(t.authToken||"phone_auth_token");localStorage.removeItem("authenticatedUser")}}catch(e){o.k.error("Error checking phone authentication token",e)}return null},async isAuthenticated(){let e=await this.getCurrentUser();if(e)return!0;try{let e=localStorage.getItem("authenticatedUser");if(e){let t=JSON.parse(e);if(t.expires>Date.now()&&t.authenticated)return this.currentUser={id:t.userId,phone:t.phoneNumber,email:null,role:"authenticated",aud:"authenticated"},!0;localStorage.removeItem("authenticatedUser")}}catch(e){o.k.error("Error checking phone authentication",e),localStorage.removeItem("authenticatedUser")}return!1}}},5667:function(e,t,a){"use strict";a.d(t,{b:function(){return o}});var n=a(7729),r=a(5477);let o={token:null,expires:0,async getToken(){try{var e;if(this.token&&this.expires>Date.now())return this.token;let t=await fetch("".concat(r.v.api.baseUrl||"","/api/csrf"),{method:"GET",credentials:"include"}),a=await t.json();if(!a.success||!(null===(e=a.data)||void 0===e?void 0:e.token))throw Error(a.error||"Failed to get CSRF token");return this.token=a.data.token,this.expires=a.data.expires,this.token}catch(e){return n.k.error("Error fetching CSRF token",e),this.generateFallbackToken()}},generateFallbackToken(){let e=new Uint8Array(32);crypto.getRandomValues(e);let t=Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("");return this.token=t,this.expires=Date.now()+3e5,n.k.warn("Using fallback CSRF token"),t},async includeToken(e){let t=await this.getToken();return{...e,csrf_token:t}}}}},function(e){e.O(0,[910,478,82,854,971,472,744],function(){return e(e.s=6471)}),_N_E=e.O()}]);